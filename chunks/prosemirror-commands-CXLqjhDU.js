import{f as j,r as N,R as T,a as R,l as I,c as B}from"./prosemirror-transform-AOGtR5Bz.js";import{d as x}from"./prosemirror-model-BL7fTrkh.js";import{d}from"./prosemirror-state-D-8NX-8X.js";const F=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function W(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const P=(t,e,n)=>{let r=W(t,n);if(!r)return!1;let o=v(r);if(!o){let i=r.blockRange(),f=i&&I(i);return f==null?!1:(e&&e(t.tr.lift(i,f).scrollIntoView()),!0)}let l=o.nodeBefore;if(E(t,o,e,-1))return!0;if(r.parent.content.size==0&&(y(l,"end")||d.NodeSelection.isSelectable(l)))for(let i=r.depth;;i--){let f=N(t.doc,r.before(i),r.after(i),x.Slice.empty);if(f&&f.slice.size<f.to-f.from){if(e){let c=t.tr.step(f);c.setSelection(y(l,"end")?d.Selection.findFrom(c.doc.resolve(c.mapping.map(o.pos,-1)),-1):d.NodeSelection.create(c.doc,o.pos-l.nodeSize)),e(c.scrollIntoView())}return!0}if(i==1||r.node(i-1).childCount>1)break}return l.isAtom&&o.depth==r.depth-1?(e&&e(t.tr.delete(o.pos-l.nodeSize,o.pos).scrollIntoView()),!0):!1};function y(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const K=(t,e,n)=>{let{$head:r,empty:o}=t.selection,l=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;l=v(r)}let i=l&&l.nodeBefore;return!i||!d.NodeSelection.isSelectable(i)?!1:(e&&e(t.tr.setSelection(d.NodeSelection.create(t.doc,l.pos-i.nodeSize)).scrollIntoView()),!0)};function v(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function q(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const H=(t,e,n)=>{let r=q(t,n);if(!r)return!1;let o=D(r);if(!o)return!1;let l=o.nodeAfter;if(E(t,o,e,1))return!0;if(r.parent.content.size==0&&(y(l,"start")||d.NodeSelection.isSelectable(l))){let i=N(t.doc,r.before(),r.after(),x.Slice.empty);if(i&&i.slice.size<i.to-i.from){if(e){let f=t.tr.step(i);f.setSelection(y(l,"start")?d.Selection.findFrom(f.doc.resolve(f.mapping.map(o.pos)),1):d.NodeSelection.create(f.doc,f.mapping.map(o.pos))),e(f.scrollIntoView())}return!0}}return l.isAtom&&o.depth==r.depth-1?(e&&e(t.tr.delete(o.pos,o.pos+l.nodeSize).scrollIntoView()),!0):!1},J=(t,e,n)=>{let{$head:r,empty:o}=t.selection,l=r;if(!o)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;l=D(r)}let i=l&&l.nodeAfter;return!i||!d.NodeSelection.isSelectable(i)?!1:(e&&e(t.tr.setSelection(d.NodeSelection.create(t.doc,l.pos)).scrollIntoView()),!0)};function D(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const G=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function M(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const L=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let o=n.node(-1),l=n.indexAfter(-1),i=M(o.contentMatchAt(l));if(!i||!o.canReplaceWith(l,l,i))return!1;if(e){let f=n.after(),c=t.tr.replaceWith(f,f,i.createAndFill());c.setSelection(d.Selection.near(c.doc.resolve(f),1)),e(c.scrollIntoView())}return!0},Q=(t,e)=>{let n=t.selection,{$from:r,$to:o}=n;if(n instanceof d.AllSelection||r.parent.inlineContent||o.parent.inlineContent)return!1;let l=M(o.parent.contentMatchAt(o.indexAfter()));if(!l||!l.isTextblock)return!1;if(e){let i=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,f=t.tr.insert(i,l.createAndFill());f.setSelection(d.TextSelection.create(f.doc,i+1)),e(f.scrollIntoView())}return!0},U=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let l=n.before();if(B(t.doc,l))return e&&e(t.tr.split(l).scrollIntoView()),!0}let r=n.blockRange(),o=r&&I(r);return o==null?!1:(e&&e(t.tr.lift(r,o).scrollIntoView()),!0)};function X(t){return(e,n)=>{let{$from:r,$to:o}=e.selection;if(e.selection instanceof d.NodeSelection&&e.selection.node.isBlock)return!r.parentOffset||!B(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let l=[],i,f,c=!1,S=!1;for(let s=r.depth;;s--)if(r.node(s).isBlock){c=r.end(s)==r.pos+(r.depth-s),S=r.start(s)==r.pos-(r.depth-s),f=M(r.node(s-1).contentMatchAt(r.indexAfter(s-1))),l.unshift(c&&f?{type:f}:null),i=s;break}else{if(s==1)return!1;l.unshift(null)}let a=e.tr;(e.selection instanceof d.TextSelection||e.selection instanceof d.AllSelection)&&a.deleteSelection();let p=a.mapping.map(r.pos),b=B(a.doc,p,l.length,l);if(b||(l[0]=f?{type:f}:null,b=B(a.doc,p,l.length,l)),a.split(p,l.length,l),!c&&S&&r.node(i).type!=f){let s=a.mapping.map(r.before(i)),u=a.doc.resolve(s);f&&r.node(i-1).canReplaceWith(u.index(),u.index()+1,f)&&a.setNodeMarkup(a.mapping.map(r.before(i)),f)}return n&&n(a.scrollIntoView()),!0}}const Y=X(),Z=(t,e)=>(e&&e(t.tr.setSelection(new d.AllSelection(t.doc))),!0);function _(t,e,n){let r=e.nodeBefore,o=e.nodeAfter,l=e.index();return!r||!o||!r.type.compatibleContent(o.type)?!1:!r.content.size&&e.parent.canReplace(l-1,l)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(l,l+1)||!(o.isTextblock||R(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function E(t,e,n,r){let o=e.nodeBefore,l=e.nodeAfter,i,f,c=o.type.spec.isolating||l.type.spec.isolating;if(!c&&_(t,e,n))return!0;let S=!c&&e.parent.canReplace(e.index(),e.index()+1);if(S&&(i=(f=o.contentMatchAt(o.childCount)).findWrapping(l.type))&&f.matchType(i[0]||l.type).validEnd){if(n){let s=e.pos+l.nodeSize,u=x.Fragment.empty;for(let k=i.length-1;k>=0;k--)u=x.Fragment.from(i[k].create(null,u));u=x.Fragment.from(o.copy(u));let m=t.tr.step(new T(e.pos-1,s,e.pos,s,new x.Slice(u,1,0),i.length,!0)),g=m.doc.resolve(s+2*i.length);g.nodeAfter&&g.nodeAfter.type==o.type&&R(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let a=l.type.spec.isolating||r>0&&c?null:d.Selection.findFrom(e,1),p=a&&a.$from.blockRange(a.$to),b=p&&I(p);if(b!=null&&b>=e.depth)return n&&n(t.tr.lift(p,b).scrollIntoView()),!0;if(S&&y(l,"start",!0)&&y(o,"end")){let s=o,u=[];for(;u.push(s),!s.isTextblock;)s=s.lastChild;let m=l,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(s.canReplace(s.childCount,s.childCount,m.content)){if(n){let k=x.Fragment.empty;for(let A=u.length-1;A>=0;A--)k=x.Fragment.from(u[A].copy(k));let h=t.tr.step(new T(e.pos-u.length,e.pos+l.nodeSize,e.pos+g,e.pos+l.nodeSize-g,new x.Slice(k,u.length,0),0,!0));n(h.scrollIntoView())}return!0}}return!1}function O(t){return function(e,n){let r=e.selection,o=t<0?r.$from:r.$to,l=o.depth;for(;o.node(l).isInline;){if(!l)return!1;l--}return o.node(l).isTextblock?(n&&n(e.tr.setSelection(d.TextSelection.create(e.doc,t<0?o.start(l):o.end(l)))),!0):!1}}const ee=O(-1),te=O(1);function fe(t,e=null){return function(n,r){let{$from:o,$to:l}=n.selection,i=o.blockRange(l),f=i&&j(i,t,e);return f?(r&&r(n.tr.wrap(i,f).scrollIntoView()),!0):!1}}function ce(t,e=null){return function(n,r){let o=!1;for(let l=0;l<n.selection.ranges.length&&!o;l++){let{$from:{pos:i},$to:{pos:f}}=n.selection.ranges[l];n.doc.nodesBetween(i,f,(c,S)=>{if(o)return!1;if(!(!c.isTextblock||c.hasMarkup(t,e)))if(c.type==t)o=!0;else{let a=n.doc.resolve(S),p=a.index();o=a.parent.canReplaceWith(p,p+1,t)}})}if(!o)return!1;if(r){let l=n.tr;for(let i=0;i<n.selection.ranges.length;i++){let{$from:{pos:f},$to:{pos:c}}=n.selection.ranges[i];l.setBlockType(f,c,t,e)}r(l.scrollIntoView())}return!0}}function re(t,e,n,r){for(let o=0;o<e.length;o++){let{$from:l,$to:i}=e[o],f=l.depth==0?t.inlineContent&&t.type.allowsMarkType(n):!1;if(t.nodesBetween(l.pos,i.pos,(c,S)=>{if(f||!r)return!1;f=c.inlineContent&&c.type.allowsMarkType(n)}),f)return!0}return!1}function se(t,e=null,n){let r=n!==!1;return function(o,l){let{empty:i,$cursor:f,ranges:c}=o.selection;if(i&&!f||!re(o.doc,c,t,r))return!1;if(l)if(f)t.isInSet(o.storedMarks||f.marks())?l(o.tr.removeStoredMark(t)):l(o.tr.addStoredMark(t.create(e)));else{let S,a=o.tr;S=!c.some(p=>o.doc.rangeHasMark(p.$from.pos,p.$to.pos,t));for(let p=0;p<c.length;p++){let{$from:b,$to:s}=c[p];if(!S)a.removeMark(b.pos,s.pos,t);else{let u=b.pos,m=s.pos,g=b.nodeAfter,k=s.nodeBefore,h=g&&g.isText?/^\s*/.exec(g.text)[0].length:0,A=k&&k.isText?/\s*$/.exec(k.text)[0].length:0;u+h<m&&(u+=h,m-=A),a.addMark(u,m,t.create(e))}}l(a.scrollIntoView())}return!0}}function V(...t){return function(e,n,r){for(let o=0;o<t.length;o++)if(t[o](e,n,r))return!0;return!1}}let C=V(F,P,K),z=V(F,H,J);const w={Enter:V(G,Q,U,Y),"Mod-Enter":L,Backspace:C,"Mod-Backspace":C,"Shift-Backspace":C,Delete:z,"Mod-Delete":z,"Mod-a":Z},$={"Ctrl-h":w.Backspace,"Alt-Backspace":w["Mod-Backspace"],"Ctrl-d":w.Delete,"Ctrl-Alt-Backspace":w["Mod-Delete"],"Alt-Delete":w["Mod-Delete"],"Alt-d":w["Mod-Delete"],"Ctrl-a":ee,"Ctrl-e":te};for(let t in w)$[t]=w[t];const ne=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,ae=ne?$:w;export{Z as a,ae as b,V as c,F as d,L as e,H as j,G as n,ce as s,se as t,fe as w};
