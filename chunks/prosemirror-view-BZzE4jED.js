import{r as Bo}from"./prosemirror-state-D-8NX-8X.js";import{r as zo}from"./prosemirror-model-BL7fTrkh.js";import{b as Lo}from"./prosemirror-transform-AOGtR5Bz.js";var se={},qn;function qo(){if(qn)return se;qn=1;function gt(e,r){return Hn(e)||Kn(e,r)||vt(e,r)||$n()}function $n(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kn(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,o,i,s,a=[],l=!0,u=!1;try{if(i=(t=t.call(e)).next,r!==0)for(;!(l=(n=i.call(t)).done)&&(a.push(n.value),a.length!==r);l=!0);}catch(f){u=!0,o=f}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}function Hn(e){if(Array.isArray(e))return e}function Ue(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vt(e))||r){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,a;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return i=u.done,u},e:function(u){s=!0,a=u},f:function(){try{!i&&t.return!=null&&t.return()}finally{if(s)throw a}}}}function vt(e,r){if(e){if(typeof e=="string")return yt(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return yt(e,r)}}function yt(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function $(){return typeof Reflect<"u"&&Reflect.get?$=Reflect.get.bind():$=function(r,t,n){var o=Wn(r,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(arguments.length<3?r:n):i.value}},$.apply(this,arguments)}function Wn(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=I(e),e!==null););return e}function ae(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Ye(e,r)}function Ye(e,r){return Ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},Ye(e,r)}function le(e){var r=Un();return function(){var n=I(e),o;if(r){var i=I(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return Gn(this,o)}}function Gn(e,r){if(r&&(ve(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kt(e)}function kt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},I(e)}function ve(e){"@babel/helpers - typeof";return ve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ve(e)}function M(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function bt(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Yn(n.key),n)}}function T(e,r,t){return r&&bt(e.prototype,r),t&&bt(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yn(e){var r=jn(e,"string");return ve(r)==="symbol"?r:String(r)}function jn(e,r){if(ve(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r);if(ve(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var k=Bo(),O=zo(),Jn=Lo,V=function(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t},Ce=function(r){var t=r.assignedSlot||r.parentNode;return t&&t.nodeType==11?t.host:t},je=null,w=function(r,t,n){var o=je||(je=document.createRange());return o.setEnd(r,n??r.nodeValue.length),o.setStart(r,t||0),o},Zn=function(){je=null},ue=function(r,t,n,o){return n&&(Dt(r,t,n,o,-1)||Dt(r,t,n,o,1))},Qn=/^(img|br|input|textarea|hr)$/i;function Dt(e,r,t,n,o){for(;;){if(e==t&&r==n)return!0;if(r==(o<0?0:K(e))){var i=e.parentNode;if(!i||i.nodeType!=1||Me(e)||Qn.test(e.nodeName)||e.contentEditable=="false")return!1;r=V(e)+(o<0?0:1),e=i}else if(e.nodeType==1){if(e=e.childNodes[r+(o<0?-1:0)],e.contentEditable=="false")return!1;r=o<0?K(e):0}else return!1}}function K(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Xn(e,r){for(;;){if(e.nodeType==3&&r)return e;if(e.nodeType==1&&r>0){if(e.contentEditable=="false")return null;e=e.childNodes[r-1],r=K(e)}else if(e.parentNode&&!Me(e))r=V(e),e=e.parentNode;else return null}}function wn(e,r){for(;;){if(e.nodeType==3&&r<e.nodeValue.length)return e;if(e.nodeType==1&&r<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[r],r=0}else if(e.parentNode&&!Me(e))r=V(e)+1,e=e.parentNode;else return null}}function _n(e,r,t){for(var n=r==0,o=r==K(e);n||o;){if(e==t)return!0;var i=V(e);if(e=e.parentNode,!e)return!1;n=n&&i==0,o=o&&i==K(e)}}function Me(e){for(var r,t=e;t&&!(r=t.pmViewDesc);t=t.parentNode);return r&&r.node&&r.node.isBlock&&(r.dom==e||r.contentDOM==e)}var ze=function(r){return r.focusNode&&ue(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function fe(e,r){var t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=e,t.key=t.code=r,t}function er(e){for(var r=e.activeElement;r&&r.shadowRoot;)r=r.shadowRoot.activeElement;return r}function tr(e,r,t){if(e.caretPositionFromPoint)try{var n=e.caretPositionFromPoint(r,t);if(n)return{node:n.offsetNode,offset:Math.min(K(n.offsetNode),n.offset)}}catch{}if(e.caretRangeFromPoint){var o=e.caretRangeFromPoint(r,t);if(o)return{node:o.startContainer,offset:Math.min(K(o.startContainer),o.startOffset)}}}var Q=typeof navigator<"u"?navigator:null,St=typeof document<"u"?document:null,te=Q&&Q.userAgent||"",Je=/Edge\/(\d+)/.exec(te),Nt=/MSIE \d/.exec(te),Ze=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(te),q=!!(Nt||Ze||Je),ne=Nt?document.documentMode:Ze?+Ze[1]:Je?+Je[1]:0,U=!q&&/gecko\/(\d+)/i.test(te);U&&+(/Firefox\/(\d+)/.exec(te)||[0,0])[1];var Qe=!q&&/Chrome\/(\d+)/.exec(te),E=!!Qe,Ot=Qe?+Qe[1]:0,B=!q&&!!Q&&/Apple Computer/.test(Q.vendor),ye=B&&(/Mobile\/\w+/.test(te)||!!Q&&Q.maxTouchPoints>2),H=ye||(Q?/Mac/.test(Q.platform):!1),nr=Q?/Win/.test(Q.platform):!1,Y=/Android \d/.test(te),Te=!!St&&"webkitFontSmoothing"in St.documentElement.style,rr=Te?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function or(e){var r=e.defaultView&&e.defaultView.visualViewport;return r?{left:0,right:r.width,top:0,bottom:r.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function _(e,r){return typeof e=="number"?e:e[r]}function ir(e){var r=e.getBoundingClientRect(),t=r.width/e.offsetWidth||1,n=r.height/e.offsetHeight||1;return{left:r.left,right:r.left+e.clientWidth*t,top:r.top,bottom:r.top+e.clientHeight*n}}function Ct(e,r,t){for(var n=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument,s=t||e.dom;s;s=Ce(s))if(s.nodeType==1){var a=s,l=a==i.body,u=l?or(i):ir(a),f=0,d=0;if(r.top<u.top+_(n,"top")?d=-(u.top-r.top+_(o,"top")):r.bottom>u.bottom-_(n,"bottom")&&(d=r.bottom-r.top>u.bottom-u.top?r.top+_(o,"top")-u.top:r.bottom-u.bottom+_(o,"bottom")),r.left<u.left+_(n,"left")?f=-(u.left-r.left+_(o,"left")):r.right>u.right-_(n,"right")&&(f=r.right-u.right+_(o,"right")),f||d)if(l)i.defaultView.scrollBy(f,d);else{var c=a.scrollLeft,h=a.scrollTop;d&&(a.scrollTop+=d),f&&(a.scrollLeft+=f);var p=a.scrollLeft-c,g=a.scrollTop-h;r={left:r.left-p,top:r.top-g,right:r.right-p,bottom:r.bottom-g}}if(l||/^(fixed|sticky)$/.test(getComputedStyle(s).position))break}}function sr(e){for(var r=e.dom.getBoundingClientRect(),t=Math.max(0,r.top),n,o,i=(r.left+r.right)/2,s=t+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=e.root.elementFromPoint(i,s);if(!(!a||a==e.dom||!e.dom.contains(a))){var l=a.getBoundingClientRect();if(l.top>=t-20){n=a,o=l.top;break}}}return{refDOM:n,refTop:o,stack:Mt(e.dom)}}function Mt(e){for(var r=[],t=e.ownerDocument,n=e;n&&(r.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),e!=t);n=Ce(n));return r}function ar(e){var r=e.refDOM,t=e.refTop,n=e.stack,o=r?r.getBoundingClientRect().top:0;Tt(n,o==0?0:o-t)}function Tt(e,r){for(var t=0;t<e.length;t++){var n=e[t],o=n.dom,i=n.top,s=n.left;o.scrollTop!=i+r&&(o.scrollTop=i+r),o.scrollLeft!=s&&(o.scrollLeft=s)}}var ke=null;function lr(e){if(e.setActive)return e.setActive();if(ke)return e.focus(ke);var r=Mt(e);e.focus(ke==null?{get preventScroll(){return ke={preventScroll:!0},!0}}:void 0),ke||(ke=!1,Tt(r,0))}function Pt(e,r){for(var t,n=2e8,o,i=0,s=r.top,a=r.top,l,u,f=e.firstChild,d=0;f;f=f.nextSibling,d++){var c=void 0;if(f.nodeType==1)c=f.getClientRects();else if(f.nodeType==3)c=w(f).getClientRects();else continue;for(var h=0;h<c.length;h++){var p=c[h];if(p.top<=s&&p.bottom>=a){s=Math.max(p.bottom,s),a=Math.min(p.top,a);var g=p.left>r.left?p.left-r.left:p.right<r.left?r.left-p.right:0;if(g<n){t=f,n=g,o=g&&t.nodeType==3?{left:p.right<r.left?p.right:p.left,top:r.top}:r,f.nodeType==1&&g&&(i=d+(r.left>=(p.left+p.right)/2?1:0));continue}}else p.top>r.top&&!l&&p.left<=r.left&&p.right>=r.left&&(l=f,u={left:Math.max(p.left,Math.min(p.right,r.left)),top:p.top});!t&&(r.left>=p.right&&r.top>=p.top||r.left>=p.left&&r.top>=p.bottom)&&(i=d+1)}}return!t&&l&&(t=l,o=u,n=0),t&&t.nodeType==3?ur(t,o):!t||n&&t.nodeType==1?{node:e,offset:i}:Pt(t,o)}function ur(e,r){for(var t=e.nodeValue.length,n=document.createRange(),o=0;o<t;o++){n.setEnd(e,o+1),n.setStart(e,o);var i=re(n,1);if(i.top!=i.bottom&&Xe(r,i))return{node:e,offset:o+(r.left>=(i.left+i.right)/2?1:0)}}return{node:e,offset:0}}function Xe(e,r){return e.left>=r.left-1&&e.left<=r.right+1&&e.top>=r.top-1&&e.top<=r.bottom+1}function fr(e,r){var t=e.parentNode;return t&&/^li$/i.test(t.nodeName)&&r.left<e.getBoundingClientRect().left?t:e}function cr(e,r,t){var n=Pt(r,t),o=n.node,i=n.offset,s=-1;if(o.nodeType==1&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&t.left>(a.left+a.right)/2?1:-1}return e.docView.posFromDOM(o,i,s)}function dr(e,r,t,n){for(var o=-1,i=r,s=!1;i!=e.dom;){var a=e.docView.nearestDesc(i,!0);if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)){var l=a.dom.getBoundingClientRect();if(a.node.isBlock&&a.parent&&(!s&&l.left>n.left||l.top>n.top?o=a.posBefore:(!s&&l.right<n.left||l.bottom<n.top)&&(o=a.posAfter),s=!0),!a.contentDOM&&o<0&&!a.node.isText){var u=a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2;return u?a.posBefore:a.posAfter}}i=a.dom.parentNode}return o>-1?o:e.docView.posFromDOM(r,t,-1)}function Vt(e,r,t){var n=e.childNodes.length;if(n&&t.top<t.bottom)for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(r.top-t.top)/(t.bottom-t.top))-2)),i=o;;){var s=e.childNodes[i];if(s.nodeType==1)for(var a=s.getClientRects(),l=0;l<a.length;l++){var u=a[l];if(Xe(r,u))return Vt(s,r,u)}if((i=(i+1)%n)==o)break}return e}function hr(e,r){var t=e.dom.ownerDocument,n,o=0,i=tr(t,r.left,r.top);i&&(n=i.node,o=i.offset);var s=(e.root.elementFromPoint?e.root:t).elementFromPoint(r.left,r.top),a;if(!s||!e.dom.contains(s.nodeType!=1?s.parentNode:s)){var l=e.dom.getBoundingClientRect();if(!Xe(r,l)||(s=Vt(e.dom,r,l),!s))return null}if(B)for(var u=s;n&&u;u=Ce(u))u.draggable&&(n=void 0);if(s=fr(s,r),n){if(U&&n.nodeType==1&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){var f=n.childNodes[o],d;f.nodeName=="IMG"&&(d=f.getBoundingClientRect()).right<=r.left&&d.bottom>r.top&&o++}var c;Te&&o&&n.nodeType==1&&(c=n.childNodes[o-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=r.top&&o--,n==e.dom&&o==n.childNodes.length-1&&n.lastChild.nodeType==1&&r.top>n.lastChild.getBoundingClientRect().bottom?a=e.state.doc.content.size:(o==0||n.nodeType!=1||n.childNodes[o-1].nodeName!="BR")&&(a=dr(e,n,o,r))}a==null&&(a=cr(e,s,r));var h=e.docView.nearestDesc(s,!0);return{pos:a,inside:h?h.posAtStart-h.border:-1}}function xt(e){return e.top<e.bottom||e.left<e.right}function re(e,r){var t=e.getClientRects();if(t.length){var n=t[r<0?0:t.length-1];if(xt(n))return n}return Array.prototype.find.call(t,xt)||e.getBoundingClientRect()}var pr=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Et(e,r,t){var n=e.docView.domFromPos(r,t<0?-1:1),o=n.node,i=n.offset,s=n.atom,a=Te||U;if(o.nodeType==3)if(a&&(pr.test(o.nodeValue)||(t<0?!i:i==o.nodeValue.length))){var l=re(w(o,i,i),t);if(U&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var u=re(w(o,i-1,i-1),-1);if(u.top==l.top){var f=re(w(o,i,i+1),-1);if(f.top!=l.top)return Pe(f,f.left<u.left)}}return l}else{var d=i,c=i,h=t<0?1:-1;return t<0&&!i?(c++,h=-1):t>=0&&i==o.nodeValue.length?(d--,h=1):t<0?d--:c++,Pe(re(w(o,d,c),h),h<0)}var p=e.state.doc.resolve(r-(s||0));if(!p.parent.inlineContent){if(s==null&&i&&(t<0||i==K(o))){var g=o.childNodes[i-1];if(g.nodeType==1)return we(g.getBoundingClientRect(),!1)}if(s==null&&i<K(o)){var v=o.childNodes[i];if(v.nodeType==1)return we(v.getBoundingClientRect(),!0)}return we(o.getBoundingClientRect(),t>=0)}if(s==null&&i&&(t<0||i==K(o))){var m=o.childNodes[i-1],S=m.nodeType==3?w(m,K(m)-(a?0:1)):m.nodeType==1&&(m.nodeName!="BR"||!m.nextSibling)?m:null;if(S)return Pe(re(S,1),!1)}if(s==null&&i<K(o)){for(var b=o.childNodes[i];b.pmViewDesc&&b.pmViewDesc.ignoreForCoords;)b=b.nextSibling;var y=b?b.nodeType==3?w(b,0,a?0:1):b.nodeType==1?b:null:null;if(y)return Pe(re(y,-1),!0)}return Pe(re(o.nodeType==3?w(o):o,-t),t>=0)}function Pe(e,r){if(e.width==0)return e;var t=r?e.left:e.right;return{top:e.top,bottom:e.bottom,left:t,right:t}}function we(e,r){if(e.height==0)return e;var t=r?e.top:e.bottom;return{top:t,bottom:t,left:e.left,right:e.right}}function At(e,r,t){var n=e.state,o=e.root.activeElement;n!=r&&e.updateState(r),o!=e.dom&&e.focus();try{return t()}finally{n!=r&&e.updateState(n),o!=e.dom&&o&&o.focus()}}function mr(e,r,t){var n=r.selection,o=t=="up"?n.$from:n.$to;return At(e,r,function(){for(var i=e.docView.domFromPos(o.pos,t=="up"?-1:1),s=i.node;;){var a=e.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}for(var l=Et(e,o.pos,1),u=s.firstChild;u;u=u.nextSibling){var f=void 0;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=w(u,0,u.nodeValue.length).getClientRects();else continue;for(var d=0;d<f.length;d++){var c=f[d];if(c.bottom>c.top+1&&(t=="up"?l.top-c.top>(c.bottom-l.top)*2:c.bottom-l.bottom>(l.bottom-c.top)*2))return!1}}return!0})}var gr=/[\u0590-\u08ac]/;function vr(e,r,t){var n=r.selection.$head;if(!n.parent.isTextblock)return!1;var o=n.parentOffset,i=!o,s=o==n.parent.content.size,a=e.domSelection();return a?!gr.test(n.parent.textContent)||!a.modify?t=="left"||t=="backward"?i:s:At(e,r,function(){var l=e.domSelectionRange(),u=l.focusNode,f=l.focusOffset,d=l.anchorNode,c=l.anchorOffset,h=a.caretBidiLevel;a.modify("move",t,"character");var p=n.depth?e.docView.domAfterPos(n.before()):e.dom,g=e.domSelectionRange(),v=g.focusNode,m=g.focusOffset,S=v&&!p.contains(v.nodeType==1?v:v.parentNode)||u==v&&f==m;try{a.collapse(d,c),u&&(u!=d||f!=c)&&a.extend&&a.extend(u,f)}catch{}return h!=null&&(a.caretBidiLevel=h),S}):n.pos==n.start()||n.pos==n.end()}var Rt=null,Ft=null,It=!1;function yr(e,r,t){return Rt==r&&Ft==t?It:(Rt=r,Ft=t,It=t=="up"||t=="down"?mr(e,r,t):vr(e,r,t))}var W=0,Bt=1,ce=2,X=3,Ve=function(){function e(r,t,n,o){M(this,e),this.parent=r,this.children=t,this.dom=n,this.contentDOM=o,this.dirty=W,n.pmViewDesc=this}return T(e,[{key:"matchesWidget",value:function(t){return!1}},{key:"matchesMark",value:function(t){return!1}},{key:"matchesNode",value:function(t,n,o){return!1}},{key:"matchesHack",value:function(t){return!1}},{key:"parseRule",value:function(){return null}},{key:"stopEvent",value:function(t){return!1}},{key:"size",get:function(){for(var t=0,n=0;n<this.children.length;n++)t+=this.children[n].size;return t}},{key:"border",get:function(){return 0}},{key:"destroy",value:function(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(var t=0;t<this.children.length;t++)this.children[t].destroy()}},{key:"posBeforeChild",value:function(t){for(var n=0,o=this.posAtStart;;n++){var i=this.children[n];if(i==t)return o;o+=i.size}}},{key:"posBefore",get:function(){return this.parent.posBeforeChild(this)}},{key:"posAtStart",get:function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}},{key:"posAfter",get:function(){return this.posBefore+this.size}},{key:"posAtEnd",get:function(){return this.posAtStart+this.size-2*this.border}},{key:"localPosFromDOM",value:function(t,n,o){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(o<0){var i,s;if(t==this.contentDOM)i=t.childNodes[n-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;i=t.previousSibling}for(;i&&!((s=i.pmViewDesc)&&s.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(s)+s.size:this.posAtStart}else{var a,l;if(t==this.contentDOM)a=t.childNodes[n];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;a=t.nextSibling}for(;a&&!((l=a.pmViewDesc)&&l.parent==this);)a=a.nextSibling;return a?this.posBeforeChild(l):this.posAtEnd}var u;if(t==this.dom&&this.contentDOM)u=n>V(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))u=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(var f=t;;f=f.parentNode){if(f==this.dom){u=!1;break}if(f.previousSibling)break}if(u==null&&n==t.childNodes.length)for(var d=t;;d=d.parentNode){if(d==this.dom){u=!0;break}if(d.nextSibling)break}}return u??o>0?this.posAtEnd:this.posAtStart}},{key:"nearestDesc",value:function(t){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=!0,i=t;i;i=i.parentNode){var s=this.getDesc(i),a=void 0;if(s&&(!n||s.node))if(o&&(a=s.nodeDOM)&&!(a.nodeType==1?a.contains(t.nodeType==1?t:t.parentNode):a==t))o=!1;else return s}}},{key:"getDesc",value:function(t){for(var n=t.pmViewDesc,o=n;o;o=o.parent)if(o==this)return n}},{key:"posFromDOM",value:function(t,n,o){for(var i=t;i;i=i.parentNode){var s=this.getDesc(i);if(s)return s.localPosFromDOM(t,n,o)}return-1}},{key:"descAt",value:function(t){for(var n=0,o=0;n<this.children.length;n++){var i=this.children[n],s=o+i.size;if(o==t&&s!=o){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(t<s)return i.descAt(t-o-i.border);o=s}}},{key:"domFromPos",value:function(t,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};for(var o=0,i=0,s=0;o<this.children.length;o++){var a=this.children[o],l=s+a.size;if(l>t||a instanceof $t){i=t-s;break}s=l}if(i)return this.children[o].domFromPos(i-this.children[o].border,n);for(var u;o&&!(u=this.children[o-1]).size&&u instanceof zt&&u.side>=0;o--);if(n<=0){for(var f,d=!0;f=o?this.children[o-1]:null,!(!f||f.dom.parentNode==this.contentDOM);o--,d=!1);return f&&n&&d&&!f.border&&!f.domAtom?f.domFromPos(f.size,n):{node:this.contentDOM,offset:f?V(f.dom)+1:0}}else{for(var c,h=!0;c=o<this.children.length?this.children[o]:null,!(!c||c.dom.parentNode==this.contentDOM);o++,h=!1);return c&&h&&!c.border&&!c.domAtom?c.domFromPos(0,n):{node:this.contentDOM,offset:c?V(c.dom):this.contentDOM.childNodes.length}}}},{key:"parseRange",value:function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(this.children.length==0)return{node:this.contentDOM,from:t,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var i=-1,s=-1,a=o,l=0;;l++){var u=this.children[l],f=a+u.size;if(i==-1&&t<=f){var d=a+u.border;if(t>=d&&n<=f-u.border&&u.node&&u.contentDOM&&this.contentDOM.contains(u.contentDOM))return u.parseRange(t,n,d);t=a;for(var c=l;c>0;c--){var h=this.children[c-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=V(h.dom)+1;break}t-=h.size}i==-1&&(i=0)}if(i>-1&&(f>n||l==this.children.length-1)){n=f;for(var p=l+1;p<this.children.length;p++){var g=this.children[p];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(-1)){s=V(g.dom);break}n+=g.size}s==-1&&(s=this.contentDOM.childNodes.length);break}a=f}return{node:this.contentDOM,from:t,to:n,fromOffset:i,toOffset:s}}},{key:"emptyChildAt",value:function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var n=this.children[t<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(t)}},{key:"domAfterPos",value:function(t){var n=this.domFromPos(t,0),o=n.node,i=n.offset;if(o.nodeType!=1||i==o.childNodes.length)throw new RangeError("No node after pos "+t);return o.childNodes[i]}},{key:"setSelection",value:function(t,n,o){for(var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=Math.min(t,n),a=Math.max(t,n),l=0,u=0;l<this.children.length;l++){var f=this.children[l],d=u+f.size;if(s>u&&a<d)return f.setSelection(t-u-f.border,n-u-f.border,o,i);u=d}var c=this.domFromPos(t,t?-1:1),h=n==t?c:this.domFromPos(n,n?-1:1),p=o.getSelection(),g=!1;if((U||B)&&t==n){var v=c,m=v.node,S=v.offset;if(m.nodeType==3){if(g=!!(S&&m.nodeValue[S-1]==`
`),g&&S==m.nodeValue.length)for(var b=m,y;b;b=b.parentNode){if(y=b.nextSibling){y.nodeName=="BR"&&(c=h={node:y.parentNode,offset:V(y)+1});break}var D=b.pmViewDesc;if(D&&D.node&&D.node.isBlock)break}}else{var N=m.childNodes[S-1];g=N&&(N.nodeName=="BR"||N.contentEditable=="false")}}if(U&&p.focusNode&&p.focusNode!=h.node&&p.focusNode.nodeType==1){var C=p.focusNode.childNodes[p.focusOffset];C&&C.contentEditable=="false"&&(i=!0)}if(!(!(i||g&&B)&&ue(c.node,c.offset,p.anchorNode,p.anchorOffset)&&ue(h.node,h.offset,p.focusNode,p.focusOffset))){var J=!1;if((p.extend||t==n)&&!g){p.collapse(c.node,c.offset);try{t!=n&&p.extend(h.node,h.offset),J=!0}catch{}}if(!J){if(t>n){var x=c;c=h,h=x}var R=document.createRange();R.setEnd(h.node,h.offset),R.setStart(c.node,c.offset),p.removeAllRanges(),p.addRange(R)}}}},{key:"ignoreMutation",value:function(t){return!this.contentDOM&&t.type!="selection"}},{key:"contentLost",get:function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}},{key:"markDirty",value:function(t,n){for(var o=0,i=0;i<this.children.length;i++){var s=this.children[i],a=o+s.size;if(o==a?t<=a&&n>=o:t<a&&n>o){var l=o+s.border,u=a-s.border;if(t>=l&&n<=u){this.dirty=t==o||n==a?ce:Bt,t==l&&n==u&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=X:s.markDirty(t-l,n-l);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?ce:X}o=a}this.dirty=ce}},{key:"markParentsDirty",value:function(){for(var t=1,n=this.parent;n;n=n.parent,t++){var o=t==1?ce:Bt;n.dirty<o&&(n.dirty=o)}}},{key:"domAtom",get:function(){return!1}},{key:"ignoreForCoords",get:function(){return!1}},{key:"isText",value:function(t){return!1}}]),e}(),zt=function(e){ae(t,e);var r=le(t);function t(n,o,i,s){var a;M(this,t);var l,u=o.type.toDOM;if(typeof u=="function"&&(u=u(i,function(){if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)})),!o.type.spec.raw){if(u.nodeType!=1){var f=document.createElement("span");f.appendChild(u),u=f}u.contentEditable="false",u.classList.add("ProseMirror-widget")}return a=r.call(this,n,[],u,null),a.widget=o,a.widget=o,l=kt(a),a}return T(t,[{key:"matchesWidget",value:function(o){return this.dirty==W&&o.type.eq(this.widget.type)}},{key:"parseRule",value:function(){return{ignore:!0}}},{key:"stopEvent",value:function(o){var i=this.widget.spec.stopEvent;return i?i(o):!1}},{key:"ignoreMutation",value:function(o){return o.type!="selection"||this.widget.spec.ignoreSelection}},{key:"destroy",value:function(){this.widget.type.destroy(this.dom),$(I(t.prototype),"destroy",this).call(this)}},{key:"domAtom",get:function(){return!0}},{key:"side",get:function(){return this.widget.type.side}}]),t}(Ve),kr=function(e){ae(t,e);var r=le(t);function t(n,o,i,s){var a;return M(this,t),a=r.call(this,n,[],o,null),a.textDOM=i,a.text=s,a}return T(t,[{key:"size",get:function(){return this.text.length}},{key:"localPosFromDOM",value:function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i}},{key:"domFromPos",value:function(o){return{node:this.textDOM,offset:o}}},{key:"ignoreMutation",value:function(o){return o.type==="characterData"&&o.target.nodeValue==o.oldValue}}]),t}(Ve),Le=function(e){ae(t,e);var r=le(t);function t(n,o,i,s){var a;return M(this,t),a=r.call(this,n,[],i,s),a.mark=o,a}return T(t,[{key:"parseRule",value:function(){return this.dirty&X||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}},{key:"matchesMark",value:function(o){return this.dirty!=X&&this.mark.eq(o)}},{key:"markDirty",value:function(o,i){if($(I(t.prototype),"markDirty",this).call(this,o,i),this.dirty!=W){for(var s=this.parent;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=W}}},{key:"slice",value:function(o,i,s){var a=t.create(this.parent,this.mark,!0,s),l=this.children,u=this.size;i<u&&(l=et(l,i,u,s)),o>0&&(l=et(l,0,o,s));for(var f=0;f<l.length;f++)l[f].parent=a;return a.children=l,a}}],[{key:"create",value:function(o,i,s,a){var l=a.nodeViews[i.type.name],u=l&&l(i,a,s);return(!u||!u.dom)&&(u=O.DOMSerializer.renderSpec(document,i.type.spec.toDOM(i,s),null,i.attrs)),new t(o,i,u.dom,u.contentDOM||u.dom)}}]),t}(Ve),be=function(e){ae(t,e);var r=le(t);function t(n,o,i,s,a,l,u,f,d){var c;return M(this,t),c=r.call(this,n,[],a,l),c.node=o,c.outerDeco=i,c.innerDeco=s,c.nodeDOM=u,c}return T(t,[{key:"parseRule",value:function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(i.preserveWhitespace="full"),!this.contentDOM)i.getContent=function(){return o.node.content};else if(!this.contentLost)i.contentElement=this.contentDOM;else{for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){i.contentElement=a.dom.parentNode;break}}i.contentElement||(i.getContent=function(){return O.Fragment.empty})}return i}},{key:"matchesNode",value:function(o,i,s){return this.dirty==W&&o.eq(this.node)&&qe(i,this.outerDeco)&&s.eq(this.innerDeco)}},{key:"size",get:function(){return this.node.nodeSize}},{key:"border",get:function(){return this.node.isLeaf?0:1}},{key:"updateChildren",value:function(o,i){var s=this,a=this.node.inlineContent,l=i,u=o.composing?this.localCompositionInfo(o,i):null,f=u&&u.pos>-1?u:null,d=u&&u.pos<0,c=new Sr(this,f&&f.node,o);Cr(this.node,this.innerDeco,function(h,p,g){h.spec.marks?c.syncToMarks(h.spec.marks,a,o):h.type.side>=0&&!g&&c.syncToMarks(p==s.node.childCount?O.Mark.none:s.node.child(p).marks,a,o),c.placeWidget(h,o,l)},function(h,p,g,v){c.syncToMarks(h.marks,a,o);var m;c.findNodeMatch(h,p,g,v)||d&&o.state.selection.from>l&&o.state.selection.to<l+h.nodeSize&&(m=c.findIndexWithChild(u.node))>-1&&c.updateNodeAt(h,p,g,m,o)||c.updateNextNode(h,p,g,o,v,l)||c.addNode(h,p,g,o,l),l+=h.nodeSize}),c.syncToMarks([],a,o),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==ce)&&(f&&this.protectLocalComposition(o,f),Kt(this.contentDOM,this.children,o),ye&&Mr(this.dom))}},{key:"localCompositionInfo",value:function(o,i){var s=o.state.selection,a=s.from,l=s.to;if(!(o.state.selection instanceof k.TextSelection)||a<i||l>i+this.node.content.size)return null;var u=o.input.compositionNode;if(!u||!this.dom.contains(u.parentNode))return null;if(this.node.inlineContent){var f=u.nodeValue,d=Tr(this.node.content,f,a-i,l-i);return d<0?null:{node:u,pos:d,text:f}}else return{node:u,pos:-1,text:""}}},{key:"protectLocalComposition",value:function(o,i){var s=i.node,a=i.pos,l=i.text;if(!this.getDesc(s)){for(var u=s;u.parentNode!=this.contentDOM;u=u.parentNode){for(;u.previousSibling;)u.parentNode.removeChild(u.previousSibling);for(;u.nextSibling;)u.parentNode.removeChild(u.nextSibling);u.pmViewDesc&&(u.pmViewDesc=void 0)}var f=new kr(this,u,s,l);o.input.compositionNodes.push(f),this.children=et(this.children,a,a+l.length,o,f)}}},{key:"update",value:function(o,i,s,a){return this.dirty==X||!o.sameMarkup(this.node)?!1:(this.updateInner(o,i,s,a),!0)}},{key:"updateInner",value:function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=W}},{key:"updateOuterDeco",value:function(o){if(!qe(o,this.outerDeco)){var i=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=Ht(this.dom,this.nodeDOM,_e(this.outerDeco,this.node,i),_e(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=o}}},{key:"selectNode",value:function(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}},{key:"deselectNode",value:function(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}},{key:"domAtom",get:function(){return this.node.isAtom}}],[{key:"create",value:function(o,i,s,a,l,u){var f=l.nodeViews[i.type.name],d,c=f&&f(i,l,function(){if(!d)return u;if(d.parent)return d.parent.posBeforeChild(d)},s,a),h=c&&c.dom,p=c&&c.contentDOM;if(i.isText){if(!h)h=document.createTextNode(i.text);else if(h.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else if(!h){var g=O.DOMSerializer.renderSpec(document,i.type.spec.toDOM(i),null,i.attrs);h=g.dom,p=g.contentDOM}!p&&!i.isText&&h.nodeName!="BR"&&(h.hasAttribute("contenteditable")||(h.contentEditable="false"),i.type.spec.draggable&&(h.draggable=!0));var v=h;return h=Wt(h,s,i),c?d=new br(o,i,s,a,h,p||null,v,c,l,u+1):i.isText?new qt(o,i,s,a,h,v,l):new t(o,i,s,a,h,p||null,v)}}]),t}(Ve);function Lt(e,r,t,n,o){Wt(n,r,e);var i=new be(void 0,e,r,t,n,n,n,o,0);return i.contentDOM&&i.updateChildren(o,0),i}var qt=function(e){ae(t,e);var r=le(t);function t(n,o,i,s,a,l,u){return M(this,t),r.call(this,n,o,i,s,a,null,l,u,0)}return T(t,[{key:"parseRule",value:function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}}},{key:"update",value:function(o,i,s,a){return this.dirty==X||this.dirty!=W&&!this.inParent()||!o.sameMarkup(this.node)?!1:(this.updateOuterDeco(i),(this.dirty!=W||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=W,!0)}},{key:"inParent",value:function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1}},{key:"domFromPos",value:function(o){return{node:this.nodeDOM,offset:o}}},{key:"localPosFromDOM",value:function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):$(I(t.prototype),"localPosFromDOM",this).call(this,o,i,s)}},{key:"ignoreMutation",value:function(o){return o.type!="characterData"&&o.type!="selection"}},{key:"slice",value:function(o,i,s){var a=this.node.cut(o,i),l=document.createTextNode(a.text);return new t(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)}},{key:"markDirty",value:function(o,i){$(I(t.prototype),"markDirty",this).call(this,o,i),this.dom!=this.nodeDOM&&(o==0||i==this.nodeDOM.nodeValue.length)&&(this.dirty=X)}},{key:"domAtom",get:function(){return!1}},{key:"isText",value:function(o){return this.node.text==o}}]),t}(be),$t=function(e){ae(t,e);var r=le(t);function t(){return M(this,t),r.apply(this,arguments)}return T(t,[{key:"parseRule",value:function(){return{ignore:!0}}},{key:"matchesHack",value:function(o){return this.dirty==W&&this.dom.nodeName==o}},{key:"domAtom",get:function(){return!0}},{key:"ignoreForCoords",get:function(){return this.dom.nodeName=="IMG"}}]),t}(Ve),br=function(e){ae(t,e);var r=le(t);function t(n,o,i,s,a,l,u,f,d,c){var h;return M(this,t),h=r.call(this,n,o,i,s,a,l,u,d,c),h.spec=f,h}return T(t,[{key:"update",value:function(o,i,s,a){if(this.dirty==X)return!1;if(this.spec.update){var l=this.spec.update(o,i,s);return l&&this.updateInner(o,i,s,a),l}else return!this.contentDOM&&!o.isLeaf?!1:$(I(t.prototype),"update",this).call(this,o,i,s,a)}},{key:"selectNode",value:function(){this.spec.selectNode?this.spec.selectNode():$(I(t.prototype),"selectNode",this).call(this)}},{key:"deselectNode",value:function(){this.spec.deselectNode?this.spec.deselectNode():$(I(t.prototype),"deselectNode",this).call(this)}},{key:"setSelection",value:function(o,i,s,a){this.spec.setSelection?this.spec.setSelection(o,i,s):$(I(t.prototype),"setSelection",this).call(this,o,i,s,a)}},{key:"destroy",value:function(){this.spec.destroy&&this.spec.destroy(),$(I(t.prototype),"destroy",this).call(this)}},{key:"stopEvent",value:function(o){return this.spec.stopEvent?this.spec.stopEvent(o):!1}},{key:"ignoreMutation",value:function(o){return this.spec.ignoreMutation?this.spec.ignoreMutation(o):$(I(t.prototype),"ignoreMutation",this).call(this,o)}}]),t}(be);function Kt(e,r,t){for(var n=e.firstChild,o=!1,i=0;i<r.length;i++){var s=r[i],a=s.dom;if(a.parentNode==e){for(;a!=n;)n=Gt(n),o=!0;n=n.nextSibling}else o=!0,e.insertBefore(a,n);if(s instanceof Le){var l=n?n.previousSibling:e.lastChild;Kt(s.contentDOM,s.children,t),n=l?l.nextSibling:e.firstChild}}for(;n;)n=Gt(n),o=!0;o&&t.trackWrites==e&&(t.trackWrites=null)}var xe=function(r){r&&(this.nodeName=r)};xe.prototype=Object.create(null);var de=[new xe];function _e(e,r,t){if(e.length==0)return de;for(var n=t?de[0]:new xe,o=[n],i=0;i<e.length;i++){var s=e[i].type.attrs;if(s){s.nodeName&&o.push(n=new xe(s.nodeName));for(var a in s){var l=s[a];l!=null&&(t&&o.length==1&&o.push(n=new xe(r.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return o}function Ht(e,r,t,n){if(t==de&&n==de)return r;for(var o=r,i=0;i<n.length;i++){var s=n[i],a=t[i];if(i){var l=void 0;a&&a.nodeName==s.nodeName&&o!=e&&(l=o.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(o),a=de[0]),o=l}Dr(o,a||de[0],s)}return o}function Dr(e,r,t){for(var n in r)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&e.removeAttribute(n);for(var o in t)o!="class"&&o!="style"&&o!="nodeName"&&t[o]!=r[o]&&e.setAttribute(o,t[o]);if(r.class!=t.class){for(var i=r.class?r.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[],a=0;a<i.length;a++)s.indexOf(i[a])==-1&&e.classList.remove(i[a]);for(var l=0;l<s.length;l++)i.indexOf(s[l])==-1&&e.classList.add(s[l]);e.classList.length==0&&e.removeAttribute("class")}if(r.style!=t.style){if(r.style)for(var u=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,f;f=u.exec(r.style);)e.style.removeProperty(f[1]);t.style&&(e.style.cssText+=t.style)}}function Wt(e,r,t){return Ht(e,e,de,_e(r,t,e.nodeType!=1))}function qe(e,r){if(e.length!=r.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].type.eq(r[t].type))return!1;return!0}function Gt(e){var r=e.nextSibling;return e.parentNode.removeChild(e),r}var Sr=function(){function e(r,t,n){M(this,e),this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=r,this.preMatch=Nr(r.node.content,r)}return T(e,[{key:"destroyBetween",value:function(t,n){if(t!=n){for(var o=t;o<n;o++)this.top.children[o].destroy();this.top.children.splice(t,n-t),this.changed=!0}}},{key:"destroyRest",value:function(){this.destroyBetween(this.index,this.top.children.length)}},{key:"syncToMarks",value:function(t,n,o){for(var i=0,s=this.stack.length>>1,a=Math.min(s,t.length);i<a&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(t[i])&&t[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=W,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<t.length;){this.stack.push(this.top,this.index+1);for(var l=-1,u=this.index;u<Math.min(this.index+3,this.top.children.length);u++){var f=this.top.children[u];if(f.matchesMark(t[s])&&!this.isLocked(f.dom)){l=u;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{var d=Le.create(this.top,t[s],n,o);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,s++}}},{key:"findNodeMatch",value:function(t,n,o,i){var s=-1,a;if(i>=this.preMatch.index&&(a=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&a.matchesNode(t,n,o))s=this.top.children.indexOf(a,this.index);else for(var l=this.index,u=Math.min(this.top.children.length,l+5);l<u;l++){var f=this.top.children[l];if(f.matchesNode(t,n,o)&&!this.preMatch.matched.has(f)){s=l;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}},{key:"updateNodeAt",value:function(t,n,o,i,s){var a=this.top.children[i];return a.dirty==X&&a.dom==a.contentDOM&&(a.dirty=ce),a.update(t,n,o,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}},{key:"findIndexWithChild",value:function(t){for(;;){var n=t.parentNode;if(!n)return-1;if(n==this.top.contentDOM){var o=t.pmViewDesc;if(o){for(var i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==o)return i}return-1}t=n}}},{key:"updateNextNode",value:function(t,n,o,i,s,a){for(var l=this.index;l<this.top.children.length;l++){var u=this.top.children[l];if(u instanceof be){var f=this.preMatch.matched.get(u);if(f!=null&&f!=s)return!1;var d=u.dom,c=void 0,h=this.isLocked(d)&&!(t.isText&&u.node&&u.node.isText&&u.nodeDOM.nodeValue==t.text&&u.dirty!=X&&qe(n,u.outerDeco));if(!h&&u.update(t,n,o,i))return this.destroyBetween(this.index,l),u.dom!=d&&(this.changed=!0),this.index++,!0;if(!h&&(c=this.recreateWrapper(u,t,n,o,i,a)))return this.destroyBetween(this.index,l),this.top.children[this.index]=c,c.contentDOM&&(c.dirty=ce,c.updateChildren(i,a+1),c.dirty=W),this.changed=!0,this.index++,!0;break}}return!1}},{key:"recreateWrapper",value:function(t,n,o,i,s,a){if(t.dirty||n.isAtom||!t.children.length||!t.node.content.eq(n.content)||!qe(o,t.outerDeco)||!i.eq(t.innerDeco))return null;var l=be.create(this.top,n,o,i,s,a);if(l.contentDOM){l.children=t.children,t.children=[];var u=Ue(l.children),f;try{for(u.s();!(f=u.n()).done;){var d=f.value;d.parent=l}}catch(c){u.e(c)}finally{u.f()}}return t.destroy(),l}},{key:"addNode",value:function(t,n,o,i,s){var a=be.create(this.top,t,n,o,i,s);a.contentDOM&&a.updateChildren(i,s+1),this.top.children.splice(this.index++,0,a),this.changed=!0}},{key:"placeWidget",value:function(t,n,o){var i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(t)&&(t==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{var s=new zt(this.top,t,n,o);this.top.children.splice(this.index++,0,s),this.changed=!0}}},{key:"addTextblockHacks",value:function(){for(var t=this.top.children[this.index-1],n=this.top;t instanceof Le;)n=t,t=n.children[n.children.length-1];(!t||!(t instanceof qt)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((B||E)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}},{key:"addHackNode",value:function(t,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(t))this.index++;else{var o=document.createElement(t);t=="IMG"&&(o.className="ProseMirror-separator",o.alt=""),t=="BR"&&(o.className="ProseMirror-trailingBreak");var i=new $t(this.top,[],o,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}},{key:"isLocked",value:function(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}]),e}();function Nr(e,r){var t=r,n=t.children.length,o=e.childCount,i=new Map,s=[];e:for(;o>0;){for(var a=void 0;;)if(n){var l=t.children[n-1];if(l instanceof Le)t=l,n=l.children.length;else{a=l,n--;break}}else{if(t==r)break e;n=t.parent.children.indexOf(t),t=t.parent}var u=a.node;if(u){if(u!=e.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}function Or(e,r){return e.type.side-r.type.side}function Cr(e,r,t,n){var o=r.locals(e),i=0;if(o.length==0){for(var s=0;s<e.childCount;s++){var a=e.child(s);n(a,o,r.forChild(i,a),s),i+=a.nodeSize}return}for(var l=0,u=[],f=null,d=0;;){for(var c=void 0,h=void 0;l<o.length&&o[l].to==i;){var p=o[l++];p.widget&&(c?(h||(h=[c])).push(p):c=p)}if(c)if(h){h.sort(Or);for(var g=0;g<h.length;g++)t(h[g],d,!!f)}else t(c,d,!!f);var v=void 0,m=void 0;if(f)m=-1,v=f,f=null;else if(d<e.childCount)m=d,v=e.child(d++);else break;for(var S=0;S<u.length;S++)u[S].to<=i&&u.splice(S--,1);for(;l<o.length&&o[l].from<=i&&o[l].to>i;)u.push(o[l++]);var b=i+v.nodeSize;if(v.isText){var y=b;l<o.length&&o[l].from<y&&(y=o[l].from);for(var D=0;D<u.length;D++)u[D].to<y&&(y=u[D].to);y<b&&(f=v.cut(y-i),v=v.cut(0,y-i),b=y,m=-1)}else for(;l<o.length&&o[l].to<b;)l++;var N=v.isInline&&!v.isLeaf?u.filter(function(C){return!C.inline}):u.slice();n(v,N,r.forChild(i,v),m),i=b}}function Mr(e){if(e.nodeName=="UL"||e.nodeName=="OL"){var r=e.style.cssText;e.style.cssText=r+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=r}}function Tr(e,r,t,n){for(var o=0,i=0;o<e.childCount&&i<=n;){var s=e.child(o++),a=i;if(i+=s.nodeSize,!!s.isText){for(var l=s.text;o<e.childCount;){var u=e.child(o++);if(i+=u.nodeSize,!u.isText)break;l+=u.text}if(i>=t){if(i>=n&&l.slice(n-r.length-a,n-a)==r)return n-r.length;var f=a<n?l.lastIndexOf(r,n-a-1):-1;if(f>=0&&f+r.length+a>=t)return a+f;if(t==n&&l.length>=n+r.length-a&&l.slice(n-a,n-a+r.length)==r)return n}}}return-1}function et(e,r,t,n,o){for(var i=[],s=0,a=0;s<e.length;s++){var l=e[s],u=a,f=a+=l.size;u>=t||f<=r?i.push(l):(u<r&&i.push(l.slice(0,r-u,n)),o&&(i.push(o),o=void 0),f>t&&i.push(l.slice(t-u,l.size,n)))}return i}function tt(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=e.domSelectionRange(),n=e.state.doc;if(!t.focusNode)return null;var o=e.docView.nearestDesc(t.focusNode),i=o&&o.size==0,s=e.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(s<0)return null;var a=n.resolve(s),l,u;if(ze(t)){for(l=s;o&&!o.node;)o=o.parent;var f=o.node;if(o&&f.isAtom&&k.NodeSelection.isSelectable(f)&&o.parent&&!(f.isInline&&_n(t.focusNode,t.focusOffset,o.dom))){var d=o.posBefore;u=new k.NodeSelection(s==d?a:n.resolve(d))}}else{if(t instanceof e.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){for(var c=s,h=s,p=0;p<t.rangeCount;p++){var g=t.getRangeAt(p);c=Math.min(c,e.docView.posFromDOM(g.startContainer,g.startOffset,1)),h=Math.max(h,e.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(c<0)return null;var v=h==e.state.selection.anchor?[h,c]:[c,h],m=gt(v,2);l=m[0],s=m[1],a=n.resolve(s)}else l=e.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}var S=n.resolve(l);if(!u){var b=r=="pointer"||e.state.selection.head<a.pos&&!i?1:-1;u=rt(e,S,a,b)}return u}function Ut(e){return e.editable?e.hasFocus():wt(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function ee(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e.state.selection;if(Zt(e,t),!!Ut(e)){if(!r&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&E){var n=e.domSelectionRange(),o=e.domObserver.currentSelection;if(n.anchorNode&&o.anchorNode&&ue(n.anchorNode,n.anchorOffset,o.anchorNode,o.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)Vr(e);else{var i=t.anchor,s=t.head,a,l;Yt&&!(t instanceof k.TextSelection)&&(t.$from.parent.inlineContent||(a=jt(e,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(l=jt(e,t.to))),e.docView.setSelection(i,s,e.root,r),Yt&&(a&&Jt(a),l&&Jt(l)),t.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Pr(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}var Yt=B||E&&Ot<63;function jt(e,r){var t=e.docView.domFromPos(r,0),n=t.node,o=t.offset,i=o<n.childNodes.length?n.childNodes[o]:null,s=o?n.childNodes[o-1]:null;if(B&&i&&i.contentEditable=="false")return nt(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return nt(i);if(s)return nt(s)}}function nt(e){return e.contentEditable="true",B&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Jt(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Pr(e){var r=e.dom.ownerDocument;r.removeEventListener("selectionchange",e.input.hideSelectionGuard);var t=e.domSelectionRange(),n=t.anchorNode,o=t.anchorOffset;r.addEventListener("selectionchange",e.input.hideSelectionGuard=function(){(t.anchorNode!=n||t.anchorOffset!=o)&&(r.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(function(){(!Ut(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function Vr(e){var r=e.domSelection(),t=document.createRange();if(r){var n=e.cursorWrapper.dom,o=n.nodeName=="IMG";o?t.setStart(n.parentNode,V(n)+1):t.setStart(n,0),t.collapse(!0),r.removeAllRanges(),r.addRange(t),!o&&!e.state.selection.visible&&q&&ne<=11&&(n.disabled=!0,n.disabled=!1)}}function Zt(e,r){if(r instanceof k.NodeSelection){var t=e.docView.descAt(r.from);t!=e.lastSelectedViewDesc&&(Qt(e),t&&t.selectNode(),e.lastSelectedViewDesc=t)}else Qt(e)}function Qt(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function rt(e,r,t,n){return e.someProp("createSelectionBetween",function(o){return o(e,r,t)})||k.TextSelection.between(r,t,n)}function Xt(e){return e.editable&&!e.hasFocus()?!1:wt(e)}function wt(e){var r=e.domSelectionRange();if(!r.anchorNode)return!1;try{return e.dom.contains(r.anchorNode.nodeType==3?r.anchorNode.parentNode:r.anchorNode)&&(e.editable||e.dom.contains(r.focusNode.nodeType==3?r.focusNode.parentNode:r.focusNode))}catch{return!1}}function xr(e){var r=e.docView.domFromPos(e.state.selection.anchor,0),t=e.domSelectionRange();return ue(r.node,r.offset,t.anchorNode,t.anchorOffset)}function ot(e,r){var t=e.selection,n=t.$anchor,o=t.$head,i=r>0?n.max(o):n.min(o),s=i.parent.inlineContent?i.depth?e.doc.resolve(r>0?i.after():i.before()):null:i;return s&&k.Selection.findFrom(s,r)}function oe(e,r){return e.dispatch(e.state.tr.setSelection(r).scrollIntoView()),!0}function _t(e,r,t){var n=e.state.selection;if(n instanceof k.TextSelection)if(t.indexOf("s")>-1){var o=n.$head,i=o.textOffset?null:r<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;var s=e.state.doc.resolve(o.pos+i.nodeSize*(r<0?-1:1));return oe(e,new k.TextSelection(n.$anchor,s))}else if(n.empty){if(e.endOfTextblock(r>0?"forward":"backward")){var a=ot(e.state,r);return a&&a instanceof k.NodeSelection?oe(e,a):!1}else if(!(H&&t.indexOf("m")>-1)){var l=n.$head,u=l.textOffset?null:r<0?l.nodeBefore:l.nodeAfter,f;if(!u||u.isText)return!1;var d=r<0?l.pos-u.nodeSize:l.pos;return u.isAtom||(f=e.docView.descAt(d))&&!f.contentDOM?k.NodeSelection.isSelectable(u)?oe(e,new k.NodeSelection(r<0?e.state.doc.resolve(l.pos-u.nodeSize):l)):Te?oe(e,new k.TextSelection(e.state.doc.resolve(r<0?d:d+u.nodeSize))):!1:!1}}else return!1;else{if(n instanceof k.NodeSelection&&n.node.isInline)return oe(e,new k.TextSelection(r>0?n.$to:n.$from));var c=ot(e.state,r);return c?oe(e,c):!1}}function $e(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function Ee(e,r){var t=e.pmViewDesc;return t&&t.size==0&&(r<0||e.nextSibling||e.nodeName!="BR")}function De(e,r){return r<0?Er(e):Ar(e)}function Er(e){var r=e.domSelectionRange(),t=r.focusNode,n=r.focusOffset;if(t){var o,i,s=!1;for(U&&t.nodeType==1&&n<$e(t)&&Ee(t.childNodes[n],-1)&&(s=!0);;)if(n>0){if(t.nodeType!=1)break;var a=t.childNodes[n-1];if(Ee(a,-1))o=t,i=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}else{if(en(t))break;for(var l=t.previousSibling;l&&Ee(l,-1);)o=t.parentNode,i=V(l),l=l.previousSibling;if(l)t=l,n=$e(t);else{if(t=t.parentNode,t==e.dom)break;n=0}}s?it(e,t,n):o&&it(e,o,i)}}function Ar(e){var r=e.domSelectionRange(),t=r.focusNode,n=r.focusOffset;if(t){for(var o=$e(t),i,s;;)if(n<o){if(t.nodeType!=1)break;var a=t.childNodes[n];if(Ee(a,1))i=t,s=++n;else break}else{if(en(t))break;for(var l=t.nextSibling;l&&Ee(l,1);)i=l.parentNode,s=V(l)+1,l=l.nextSibling;if(l)t=l,n=0,o=$e(t);else{if(t=t.parentNode,t==e.dom)break;n=o=0}}i&&it(e,i,s)}}function en(e){var r=e.pmViewDesc;return r&&r.node&&r.node.isBlock}function Rr(e,r){for(;e&&r==e.childNodes.length&&!Me(e);)r=V(e)+1,e=e.parentNode;for(;e&&r<e.childNodes.length;){var t=e.childNodes[r];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;e=t,r=0}}function Fr(e,r){for(;e&&!r&&!Me(e);)r=V(e),e=e.parentNode;for(;e&&r;){var t=e.childNodes[r-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;e=t,r=e.childNodes.length}}function it(e,r,t){if(r.nodeType!=3){var n,o;(o=Rr(r,t))?(r=o,t=0):(n=Fr(r,t))&&(r=n,t=n.nodeValue.length)}var i=e.domSelection();if(i){if(ze(i)){var s=document.createRange();s.setEnd(r,t),s.setStart(r,t),i.removeAllRanges(),i.addRange(s)}else i.extend&&i.extend(r,t);e.domObserver.setCurSelection();var a=e.state;setTimeout(function(){e.state==a&&ee(e)},50)}}function tn(e,r){var t=e.state.doc.resolve(r);if(!(E||nr)&&t.parent.inlineContent){var n=e.coordsAtPos(r);if(r>t.start()){var o=e.coordsAtPos(r-1),i=(o.top+o.bottom)/2;if(i>n.top&&i<n.bottom&&Math.abs(o.left-n.left)>1)return o.left<n.left?"ltr":"rtl"}if(r<t.end()){var s=e.coordsAtPos(r+1),a=(s.top+s.bottom)/2;if(a>n.top&&a<n.bottom&&Math.abs(s.left-n.left)>1)return s.left>n.left?"ltr":"rtl"}}var l=getComputedStyle(e.dom).direction;return l=="rtl"?"rtl":"ltr"}function nn(e,r,t){var n=e.state.selection;if(n instanceof k.TextSelection&&!n.empty||t.indexOf("s")>-1||H&&t.indexOf("m")>-1)return!1;var o=n.$from,i=n.$to;if(!o.parent.inlineContent||e.endOfTextblock(r<0?"up":"down")){var s=ot(e.state,r);if(s&&s instanceof k.NodeSelection)return oe(e,s)}if(!o.parent.inlineContent){var a=r<0?o:i,l=n instanceof k.AllSelection?k.Selection.near(a,r):k.Selection.findFrom(a,r);return l?oe(e,l):!1}return!1}function rn(e,r){if(!(e.state.selection instanceof k.TextSelection))return!0;var t=e.state.selection,n=t.$head,o=t.$anchor,i=t.empty;if(!n.sameParent(o))return!0;if(!i)return!1;if(e.endOfTextblock(r>0?"forward":"backward"))return!0;var s=!n.textOffset&&(r<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){var a=e.state.tr;return r<0?a.delete(n.pos-s.nodeSize,n.pos):a.delete(n.pos,n.pos+s.nodeSize),e.dispatch(a),!0}return!1}function on(e,r,t){e.domObserver.stop(),r.contentEditable=t,e.domObserver.start()}function Ir(e){if(!B||e.state.selection.$head.parentOffset>0)return!1;var r=e.domSelectionRange(),t=r.focusNode,n=r.focusOffset;if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){var o=t.firstChild;on(e,o,"true"),setTimeout(function(){return on(e,o,"false")},20)}return!1}function Br(e){var r="";return e.ctrlKey&&(r+="c"),e.metaKey&&(r+="m"),e.altKey&&(r+="a"),e.shiftKey&&(r+="s"),r}function zr(e,r){var t=r.keyCode,n=Br(r);if(t==8||H&&t==72&&n=="c")return rn(e,-1)||De(e,-1);if(t==46&&!r.shiftKey||H&&t==68&&n=="c")return rn(e,1)||De(e,1);if(t==13||t==27)return!0;if(t==37||H&&t==66&&n=="c"){var o=t==37?tn(e,e.state.selection.from)=="ltr"?-1:1:-1;return _t(e,o,n)||De(e,o)}else if(t==39||H&&t==70&&n=="c"){var i=t==39?tn(e,e.state.selection.from)=="ltr"?1:-1:1;return _t(e,i,n)||De(e,i)}else{if(t==38||H&&t==80&&n=="c")return nn(e,-1,n)||De(e,-1);if(t==40||H&&t==78&&n=="c")return Ir(e)||nn(e,1,n)||De(e,1);if(n==(H?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function st(e,r){e.someProp("transformCopied",function(m){r=m(r,e)});for(var t=[],n=r,o=n.content,i=n.openStart,s=n.openEnd;i>1&&s>1&&o.childCount==1&&o.firstChild.childCount==1;){i--,s--;var a=o.firstChild;t.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),o=a.content}var l=e.someProp("clipboardSerializer")||O.DOMSerializer.fromSchema(e.state.schema),u=dn(),f=u.createElement("div");f.appendChild(l.serializeFragment(o,{document:u}));for(var d=f.firstChild,c,h=0;d&&d.nodeType==1&&(c=fn[d.nodeName.toLowerCase()]);){for(var p=c.length-1;p>=0;p--){for(var g=u.createElement(c[p]);f.firstChild;)g.appendChild(f.firstChild);f.appendChild(g),h++}d=f.firstChild}d&&d.nodeType==1&&d.setAttribute("data-pm-slice","".concat(i," ").concat(s).concat(h?" -".concat(h):""," ").concat(JSON.stringify(t)));var v=e.someProp("clipboardTextSerializer",function(m){return m(r,e)})||r.content.textBetween(0,r.content.size,`

`);return{dom:f,text:v,slice:r}}function at(e,r,t,n,o){var i=o.parent.type.spec.code,s,a;if(!t&&!r)return null;var l=r&&(n||i||!t);if(l){if(e.someProp("transformPastedText",function(N){r=N(r,i||n,e)}),i)return r?new O.Slice(O.Fragment.from(e.state.schema.text(r.replace(/\r\n?/g,`
`))),0,0):O.Slice.empty;var u=e.someProp("clipboardTextParser",function(N){return N(r,o,n,e)});if(u)a=u;else{var f=o.marks(),d=e.state.schema,c=O.DOMSerializer.fromSchema(d);s=document.createElement("div"),r.split(/(?:\r\n?|\n)+/).forEach(function(N){var C=s.appendChild(document.createElement("p"));N&&C.appendChild(c.serializeNode(d.text(N,f)))})}}else e.someProp("transformPastedHTML",function(N){t=N(t,e)}),s=Kr(t),Te&&Hr(s);var h=s&&s.querySelector("[data-pm-slice]"),p=h&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(h.getAttribute("data-pm-slice")||"");if(p&&p[3])for(var g=+p[3];g>0;g--){for(var v=s.firstChild;v&&v.nodeType!=1;)v=v.nextSibling;if(!v)break;s=v}if(!a){var m=e.someProp("clipboardParser")||e.someProp("domParser")||O.DOMParser.fromSchema(e.state.schema);a=m.parseSlice(s,{preserveWhitespace:!!(l||p),context:o,ruleFromNode:function(C){return C.nodeName=="BR"&&!C.nextSibling&&C.parentNode&&!Lr.test(C.parentNode.nodeName)?{ignore:!0}:null}})}if(p)a=Wr(un(a,+p[1],+p[2]),p[4]);else if(a=O.Slice.maxOpen(qr(a.content,o),!0),a.openStart||a.openEnd){for(var S=0,b=0,y=a.content.firstChild;S<a.openStart&&!y.type.spec.isolating;S++,y=y.firstChild);for(var D=a.content.lastChild;b<a.openEnd&&!D.type.spec.isolating;b++,D=D.lastChild);a=un(a,S,b)}return e.someProp("transformPasted",function(N){a=N(a,e)}),a}var Lr=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function qr(e,r){if(e.childCount<2)return e;for(var t=function(){var s=r.node(o),a=s.contentMatchAt(r.index(o)),l,u=[];if(e.forEach(function(f){if(u){var d=a.findWrapping(f.type),c;if(!d)return u=null;if(c=u.length&&l.length&&an(d,l,f,u[u.length-1],0))u[u.length-1]=c;else{u.length&&(u[u.length-1]=ln(u[u.length-1],l.length));var h=sn(f,d);u.push(h),a=a.matchType(h.type),l=d}}}),u)return{v:O.Fragment.from(u)}},n,o=r.depth;o>=0;o--)if(n=t(),n)return n.v;return e}function sn(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=r.length-1;n>=t;n--)e=r[n].create(null,O.Fragment.from(e));return e}function an(e,r,t,n,o){if(o<e.length&&o<r.length&&e[o]==r[o]){var i=an(e,r,t,n.lastChild,o+1);if(i)return n.copy(n.content.replaceChild(n.childCount-1,i));var s=n.contentMatchAt(n.childCount);if(s.matchType(o==e.length-1?t.type:e[o+1]))return n.copy(n.content.append(O.Fragment.from(sn(t,e,o+1))))}}function ln(e,r){if(r==0)return e;var t=e.content.replaceChild(e.childCount-1,ln(e.lastChild,r-1)),n=e.contentMatchAt(e.childCount).fillBefore(O.Fragment.empty,!0);return e.copy(t.append(n))}function lt(e,r,t,n,o,i){var s=r<0?e.firstChild:e.lastChild,a=s.content;return e.childCount>1&&(i=0),o<n-1&&(a=lt(a,r,t,n,o+1,i)),o>=t&&(a=r<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(O.Fragment.empty,!0))),e.replaceChild(r<0?0:e.childCount-1,s.copy(a))}function un(e,r,t){return r<e.openStart&&(e=new O.Slice(lt(e.content,-1,r,e.openStart,0,e.openEnd),r,e.openEnd)),t<e.openEnd&&(e=new O.Slice(lt(e.content,1,t,e.openEnd,0,0),e.openStart,t)),e}var fn={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},cn=null;function dn(){return cn||(cn=document.implementation.createHTMLDocument("title"))}function $r(e){var r=window.trustedTypes;return r?r.createPolicy("detachedDocument",{createHTML:function(n){return n}}).createHTML(e):e}function Kr(e){var r=/^(\s*<meta [^>]*>)*/.exec(e);r&&(e=e.slice(r[0].length));var t=dn().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(e),o;if((o=n&&fn[n[1].toLowerCase()])&&(e=o.map(function(s){return"<"+s+">"}).join("")+e+o.map(function(s){return"</"+s+">"}).reverse().join("")),t.innerHTML=$r(e),o)for(var i=0;i<o.length;i++)t=t.querySelector(o[i])||t;return t}function Hr(e){for(var r=e.querySelectorAll(E?"span:not([class]):not([style])":"span.Apple-converted-space"),t=0;t<r.length;t++){var n=r[t];n.childNodes.length==1&&n.textContent==" "&&n.parentNode&&n.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),n)}}function Wr(e,r){if(!e.size)return e;var t=e.content.firstChild.type.schema,n;try{n=JSON.parse(r)}catch{return e}for(var o=e.content,i=e.openStart,s=e.openEnd,a=n.length-2;a>=0;a-=2){var l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;o=O.Fragment.from(l.create(n[a+1],o)),i++,s++}return new O.Slice(o,i,s)}var z={},L={},Gr={touchstart:!0,touchmove:!0},Ur=T(function e(){M(this,e),this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null});function Yr(e){var r=function(){var o=z[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=function(i){Jr(e,i)&&!ft(e,i)&&(e.editable||!(i.type in L))&&o(e,i)},Gr[t]?{passive:!0}:void 0)};for(var t in z)r();B&&e.dom.addEventListener("input",function(){return null}),ut(e)}function ie(e,r){e.input.lastSelectionOrigin=r,e.input.lastSelectionTime=Date.now()}function jr(e){e.domObserver.stop();for(var r in e.input.eventHandlers)e.dom.removeEventListener(r,e.input.eventHandlers[r]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function ut(e){e.someProp("handleDOMEvents",function(r){for(var t in r)e.input.eventHandlers[t]||e.dom.addEventListener(t,e.input.eventHandlers[t]=function(n){return ft(e,n)})})}function ft(e,r){return e.someProp("handleDOMEvents",function(t){var n=t[r.type];return n?n(e,r)||r.defaultPrevented:!1})}function Jr(e,r){if(!r.bubbles)return!0;if(r.defaultPrevented)return!1;for(var t=r.target;t!=e.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(r))return!1;return!0}function Zr(e,r){!ft(e,r)&&z[r.type]&&(e.editable||!(r.type in L))&&z[r.type](e,r)}L.keydown=function(e,r){var t=r;if(e.input.shiftKey=t.keyCode==16||t.shiftKey,!pn(e,t)&&(e.input.lastKeyCode=t.keyCode,e.input.lastKeyCodeTime=Date.now(),!(Y&&E&&t.keyCode==13)))if(e.domObserver.selectionChanged(e.domSelectionRange())?e.domObserver.flush():t.keyCode!=229&&e.domObserver.forceFlush(),ye&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n=Date.now();e.input.lastIOSEnter=n,e.input.lastIOSEnterFallbackTimeout=setTimeout(function(){e.input.lastIOSEnter==n&&(e.someProp("handleKeyDown",function(o){return o(e,fe(13,"Enter"))}),e.input.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",function(o){return o(e,t)})||zr(e,t)?t.preventDefault():ie(e,"key")},L.keyup=function(e,r){r.keyCode==16&&(e.input.shiftKey=!1)},L.keypress=function(e,r){var t=r;if(!(pn(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||H&&t.metaKey)){if(e.someProp("handleKeyPress",function(i){return i(e,t)})){t.preventDefault();return}var n=e.state.selection;if(!(n instanceof k.TextSelection)||!n.$from.sameParent(n.$to)){var o=String.fromCharCode(t.charCode);!/[\r\n]/.test(o)&&!e.someProp("handleTextInput",function(i){return i(e,n.$from.pos,n.$to.pos,o)})&&e.dispatch(e.state.tr.insertText(o).scrollIntoView()),t.preventDefault()}}};function Ke(e){return{left:e.clientX,top:e.clientY}}function Qr(e,r){var t=r.x-e.clientX,n=r.y-e.clientY;return t*t+n*n<100}function ct(e,r,t,n,o){if(n==-1)return!1;for(var i=e.state.doc.resolve(n),s=function(f){if(e.someProp(r,function(d){return f>i.depth?d(e,t,i.nodeAfter,i.before(f),o,!0):d(e,t,i.node(f),i.before(f),o,!1)}))return{v:!0}},a,l=i.depth+1;l>0;l--)if(a=s(l),a)return a.v;return!1}function Se(e,r,t){if(e.focused||e.focus(),!e.state.selection.eq(r)){var n=e.state.tr.setSelection(r);n.setMeta("pointer",!0),e.dispatch(n)}}function Xr(e,r){if(r==-1)return!1;var t=e.state.doc.resolve(r),n=t.nodeAfter;return n&&n.isAtom&&k.NodeSelection.isSelectable(n)?(Se(e,new k.NodeSelection(t)),!0):!1}function wr(e,r){if(r==-1)return!1;var t=e.state.selection,n,o;t instanceof k.NodeSelection&&(n=t.node);for(var i=e.state.doc.resolve(r),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(k.NodeSelection.isSelectable(a)){n&&t.$from.depth>0&&s>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?o=i.before(t.$from.depth):o=i.before(s);break}}return o!=null?(Se(e,k.NodeSelection.create(e.state.doc,o)),!0):!1}function _r(e,r,t,n,o){return ct(e,"handleClickOn",r,t,n)||e.someProp("handleClick",function(i){return i(e,r,n)})||(o?wr(e,t):Xr(e,t))}function eo(e,r,t,n){return ct(e,"handleDoubleClickOn",r,t,n)||e.someProp("handleDoubleClick",function(o){return o(e,r,n)})}function to(e,r,t,n){return ct(e,"handleTripleClickOn",r,t,n)||e.someProp("handleTripleClick",function(o){return o(e,r,n)})||no(e,t,n)}function no(e,r,t){if(t.button!=0)return!1;var n=e.state.doc;if(r==-1)return n.inlineContent?(Se(e,k.TextSelection.create(n,0,n.content.size)),!0):!1;for(var o=n.resolve(r),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)Se(e,k.TextSelection.create(n,a+1,a+1+s.content.size));else if(k.NodeSelection.isSelectable(s))Se(e,k.NodeSelection.create(n,a));else continue;return!0}}function dt(e){return Ae(e)}var hn=H?"metaKey":"ctrlKey";z.mousedown=function(e,r){var t=r;e.input.shiftKey=t.shiftKey;var n=dt(e),o=Date.now(),i="singleClick";o-e.input.lastClick.time<500&&Qr(t,e.input.lastClick)&&!t[hn]&&(e.input.lastClick.type=="singleClick"?i="doubleClick":e.input.lastClick.type=="doubleClick"&&(i="tripleClick")),e.input.lastClick={time:o,x:t.clientX,y:t.clientY,type:i};var s=e.posAtCoords(Ke(t));s&&(i=="singleClick"?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new ro(e,s,t,!!n)):(i=="doubleClick"?eo:to)(e,s.pos,s.inside,t)?t.preventDefault():ie(e,"pointer"))};var ro=function(){function e(r,t,n,o){var i=this;M(this,e),this.view=r,this.pos=t,this.event=n,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=r.state.doc,this.selectNode=!!n[hn],this.allowDefault=n.shiftKey;var s,a;if(t.inside>-1)s=r.state.doc.nodeAt(t.inside),a=t.inside;else{var l=r.state.doc.resolve(t.pos);s=l.parent,a=l.depth?l.before():0}var u=o?null:n.target,f=u?r.docView.nearestDesc(u,!0):null;this.target=f&&f.dom.nodeType==1?f.dom:null;var d=r.state.selection;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||d instanceof k.NodeSelection&&d.from<=a&&d.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&U&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.input.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),r.root.addEventListener("mouseup",this.up=this.up.bind(this)),r.root.addEventListener("mousemove",this.move=this.move.bind(this)),ie(r,"pointer")}return T(e,[{key:"done",value:function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return ee(t.view)}),this.view.input.mouseDown=null}},{key:"up",value:function(t){if(this.done(),!!this.view.dom.contains(t.target)){var n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Ke(t))),this.updateAllowDefault(t),this.allowDefault||!n?ie(this.view,"pointer"):_r(this.view,n.pos,n.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||B&&this.mightDrag&&!this.mightDrag.node.isAtom||E&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Se(this.view,k.Selection.near(this.view.state.doc.resolve(n.pos))),t.preventDefault()):ie(this.view,"pointer")}}},{key:"move",value:function(t){this.updateAllowDefault(t),ie(this.view,"pointer"),t.buttons==0&&this.done()}},{key:"updateAllowDefault",value:function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}]),e}();z.touchstart=function(e){e.input.lastTouch=Date.now(),dt(e),ie(e,"pointer")},z.touchmove=function(e){e.input.lastTouch=Date.now(),ie(e,"pointer")},z.contextmenu=function(e){return dt(e)};function pn(e,r){return e.composing?!0:B&&Math.abs(r.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}var oo=Y?5e3:-1;L.compositionstart=L.compositionupdate=function(e){if(!e.composing){e.domObserver.flush();var r=e.state,t=r.selection.$to;if(r.selection instanceof k.TextSelection&&(r.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(function(l){return l.type.spec.inclusive===!1})))e.markCursor=e.state.storedMarks||t.marks(),Ae(e,!0),e.markCursor=null;else if(Ae(e,!r.selection.empty),U&&r.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length)for(var n=e.domSelectionRange(),o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){var a=e.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else o=s,i=-1}e.input.composing=!0}mn(e,oo)},L.compositionend=function(e,r){e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=r.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(function(){return e.domObserver.flush()}),e.input.compositionID++,mn(e,20))};function mn(e,r){clearTimeout(e.input.composingTimeout),r>-1&&(e.input.composingTimeout=setTimeout(function(){return Ae(e)},r))}function gn(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=so());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function io(e){var r=e.domSelectionRange();if(!r.focusNode)return null;var t=Xn(r.focusNode,r.focusOffset),n=wn(r.focusNode,r.focusOffset);if(t&&n&&t!=n){var o=n.pmViewDesc,i=e.domObserver.lastChangedTextNode;if(t==i||n==i)return i;if(!o||!o.isText(n.nodeValue))return n;if(e.input.compositionNode==n){var s=t.pmViewDesc;if(!(!s||!s.isText(t.nodeValue)))return n}}return t||n}function so(){var e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function Ae(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(Y&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),gn(e),r||e.docView&&e.docView.dirty){var t=tt(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):(e.markCursor||r)&&!e.state.selection.empty?e.dispatch(e.state.tr.deleteSelection()):e.updateState(e.state),!0}return!1}}function ao(e,r){if(e.dom.parentNode){var t=e.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(r),t.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(r),e.dom.blur(),n.removeAllRanges(),n.addRange(o),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),e.focus()},50)}}var Re=q&&ne<15||ye&&rr<604;z.copy=L.cut=function(e,r){var t=r,n=e.state.selection,o=t.type=="cut";if(!n.empty){var i=Re?null:t.clipboardData,s=n.content(),a=st(e,s),l=a.dom,u=a.text;i?(t.preventDefault(),i.clearData(),i.setData("text/html",l.innerHTML),i.setData("text/plain",u)):ao(e,l),o&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function lo(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function uo(e,r){if(e.dom.parentNode){var t=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,n=e.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();var o=e.input.shiftKey&&e.input.lastKeyCode!=45;setTimeout(function(){e.focus(),n.parentNode&&n.parentNode.removeChild(n),t?Fe(e,n.value,null,o,r):Fe(e,n.textContent,n.innerHTML,o,r)},50)}}function Fe(e,r,t,n,o){var i=at(e,r,t,n,e.state.selection.$from);if(e.someProp("handlePaste",function(l){return l(e,o,i||O.Slice.empty)}))return!0;if(!i)return!1;var s=lo(i),a=s?e.state.tr.replaceSelectionWith(s,n):e.state.tr.replaceSelection(i);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function vn(e){var r=e.getData("text/plain")||e.getData("Text");if(r)return r;var t=e.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}L.paste=function(e,r){var t=r;if(!(e.composing&&!Y)){var n=Re?null:t.clipboardData,o=e.input.shiftKey&&e.input.lastKeyCode!=45;n&&Fe(e,vn(n),n.getData("text/html"),o,t)?t.preventDefault():uo(e,t)}};var yn=T(function e(r,t,n){M(this,e),this.slice=r,this.move=t,this.node=n}),kn=H?"altKey":"ctrlKey";z.dragstart=function(e,r){var t=r,n=e.input.mouseDown;if(n&&n.done(),!!t.dataTransfer){var o=e.state.selection,i=o.empty?null:e.posAtCoords(Ke(t)),s;if(!(i&&i.pos>=o.from&&i.pos<=(o instanceof k.NodeSelection?o.to-1:o.to))){if(n&&n.mightDrag)s=k.NodeSelection.create(e.state.doc,n.mightDrag.pos);else if(t.target&&t.target.nodeType==1){var a=e.docView.nearestDesc(t.target,!0);a&&a.node.type.spec.draggable&&a!=e.docView&&(s=k.NodeSelection.create(e.state.doc,a.posBefore))}}var l=(s||e.state.selection).content(),u=st(e,l),f=u.dom,d=u.text,c=u.slice;(!t.dataTransfer.files.length||!E||Ot>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(Re?"Text":"text/html",f.innerHTML),t.dataTransfer.effectAllowed="copyMove",Re||t.dataTransfer.setData("text/plain",d),e.dragging=new yn(c,!t[kn],s)}},z.dragend=function(e){var r=e.dragging;window.setTimeout(function(){e.dragging==r&&(e.dragging=null)},50)},L.dragover=L.dragenter=function(e,r){return r.preventDefault()},L.drop=function(e,r){var t=r,n=e.dragging;if(e.dragging=null,!!t.dataTransfer){var o=e.posAtCoords(Ke(t));if(o){var i=e.state.doc.resolve(o.pos),s=n&&n.slice;s?e.someProp("transformPasted",function(v){s=v(s,e)}):s=at(e,vn(t.dataTransfer),Re?null:t.dataTransfer.getData("text/html"),!1,i);var a=!!(n&&!t[kn]);if(e.someProp("handleDrop",function(v){return v(e,t,s||O.Slice.empty,a)})){t.preventDefault();return}if(s){t.preventDefault();var l=s?Jn.dropPoint(e.state.doc,i.pos,s):i.pos;l==null&&(l=i.pos);var u=e.state.tr;if(a){var f=n.node;f?f.replace(u):u.deleteSelection()}var d=u.mapping.map(l),c=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,h=u.doc;if(c?u.replaceRangeWith(d,d,s.content.firstChild):u.replaceRange(d,d,s),!u.doc.eq(h)){var p=u.doc.resolve(d);if(c&&k.NodeSelection.isSelectable(s.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(s.content.firstChild))u.setSelection(new k.NodeSelection(p));else{var g=u.mapping.map(l);u.mapping.maps[u.mapping.maps.length-1].forEach(function(v,m,S,b){return g=b}),u.setSelection(rt(e,p,u.doc.resolve(g)))}e.focus(),e.dispatch(u.setMeta("uiEvent","drop"))}}}}},z.focus=function(e){e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(function(){e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&ee(e)},20))},z.blur=function(e,r){var t=r;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),t.relatedTarget&&e.dom.contains(t.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},z.beforeinput=function(e,r){var t=r;if(E&&Y&&t.inputType=="deleteContentBackward"){e.domObserver.flushSoon();var n=e.input.domChangeCount;setTimeout(function(){if(e.input.domChangeCount==n&&(e.dom.blur(),e.focus(),!e.someProp("handleKeyDown",function(i){return i(e,fe(8,"Backspace"))}))){var o=e.state.selection.$cursor;o&&o.pos>0&&e.dispatch(e.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}};for(var bn in L)z[bn]=L[bn];function Ie(e,r){if(e==r)return!0;for(var t in e)if(e[t]!==r[t])return!1;for(var n in r)if(!(n in e))return!1;return!0}var Dn=function(){function e(r,t){M(this,e),this.toDOM=r,this.spec=t||pe,this.side=this.spec.side||0}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.mapResult(n.from+i,this.side<0?-1:1),a=s.pos,l=s.deleted;return l?null:new he(a-o,a-o,this)}},{key:"valid",value:function(){return!0}},{key:"eq",value:function(t){return this==t||t instanceof e&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Ie(this.spec,t.spec))}},{key:"destroy",value:function(t){this.spec.destroy&&this.spec.destroy(t)}}]),e}(),Be=function(){function e(r,t){M(this,e),this.attrs=r,this.spec=t||pe}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.map(n.from+i,this.spec.inclusiveStart?-1:1)-o,a=t.map(n.to+i,this.spec.inclusiveEnd?1:-1)-o;return s>=a?null:new he(s,a,this)}},{key:"valid",value:function(t,n){return n.from<n.to}},{key:"eq",value:function(t){return this==t||t instanceof e&&Ie(this.attrs,t.attrs)&&Ie(this.spec,t.spec)}},{key:"destroy",value:function(){}}],[{key:"is",value:function(t){return t.type instanceof e}}]),e}(),fo=function(){function e(r,t){M(this,e),this.attrs=r,this.spec=t||pe}return T(e,[{key:"map",value:function(t,n,o,i){var s=t.mapResult(n.from+i,1);if(s.deleted)return null;var a=t.mapResult(n.to+i,-1);return a.deleted||a.pos<=s.pos?null:new he(s.pos-o,a.pos-o,this)}},{key:"valid",value:function(t,n){var o=t.content.findIndex(n.from),i=o.index,s=o.offset,a;return s==n.from&&!(a=t.child(i)).isText&&s+a.nodeSize==n.to}},{key:"eq",value:function(t){return this==t||t instanceof e&&Ie(this.attrs,t.attrs)&&Ie(this.spec,t.spec)}},{key:"destroy",value:function(){}}]),e}(),he=function(){function e(r,t,n){M(this,e),this.from=r,this.to=t,this.type=n}return T(e,[{key:"copy",value:function(t,n){return new e(t,n,this.type)}},{key:"eq",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.type.eq(t.type)&&this.from+n==t.from&&this.to+n==t.to}},{key:"map",value:function(t,n,o){return this.type.map(t,this,n,o)}},{key:"spec",get:function(){return this.type.spec}},{key:"inline",get:function(){return this.type instanceof Be}},{key:"widget",get:function(){return this.type instanceof Dn}}],[{key:"widget",value:function(t,n,o){return new e(t,t,new Dn(n,o))}},{key:"inline",value:function(t,n,o,i){return new e(t,n,new Be(o,i))}},{key:"node",value:function(t,n,o,i){return new e(t,n,new fo(o,i))}}]),e}(),Ne=[],pe={},j=function(){function e(r,t){M(this,e),this.local=r.length?r:Ne,this.children=t.length?t:Ne}return T(e,[{key:"find",value:function(t,n,o){var i=[];return this.findInner(t??0,n??1e9,i,0,o),i}},{key:"findInner",value:function(t,n,o,i,s){for(var a=0;a<this.local.length;a++){var l=this.local[a];l.from<=n&&l.to>=t&&(!s||s(l.spec))&&o.push(l.copy(l.from+i,l.to+i))}for(var u=0;u<this.children.length;u+=3)if(this.children[u]<n&&this.children[u+1]>t){var f=this.children[u]+1;this.children[u+2].findInner(t-f,n-f,o,i+f,s)}}},{key:"map",value:function(t,n,o){return this==A||t.maps.length==0?this:this.mapInner(t,n,0,0,o||pe)}},{key:"mapInner",value:function(t,n,o,i,s){for(var a,l=0;l<this.local.length;l++){var u=this.local[l].map(t,o,i);u&&u.type.valid(n,u)?(a||(a=[])).push(u):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?co(this.children,a||[],t,n,o,i,s):a?new e(a.sort(me),Ne):A}},{key:"add",value:function(t,n){return n.length?this==A?e.create(t,n):this.addInner(t,n,0):this}},{key:"addInner",value:function(t,n,o){var i=this,s,a=0;t.forEach(function(f,d){var c=d+o,h;if(h=On(n,f,c)){for(s||(s=i.children.slice());a<s.length&&s[a]<d;)a+=3;s[a]==d?s[a+2]=s[a+2].addInner(f,h,c+1):s.splice(a,0,d,d+f.nodeSize,He(h,f,c+1,pe)),a+=3}});for(var l=Nn(a?Cn(n):n,-o),u=0;u<l.length;u++)l[u].type.valid(t,l[u])||l.splice(u--,1);return new e(l.length?this.local.concat(l).sort(me):this.local,s||this.children)}},{key:"remove",value:function(t){return t.length==0||this==A?this:this.removeInner(t,0)}},{key:"removeInner",value:function(t,n){for(var o=this.children,i=this.local,s=0;s<o.length;s+=3){for(var a=void 0,l=o[s]+n,u=o[s+1]+n,f=0,d;f<t.length;f++)(d=t[f])&&d.from>l&&d.to<u&&(t[f]=null,(a||(a=[])).push(d));if(a){o==this.children&&(o=this.children.slice());var c=o[s+2].removeInner(a,l+1);c!=A?o[s+2]=c:(o.splice(s,3),s-=3)}}if(i.length){for(var h=0,p;h<t.length;h++)if(p=t[h])for(var g=0;g<i.length;g++)i[g].eq(p,n)&&(i==this.local&&(i=this.local.slice()),i.splice(g--,1))}return o==this.children&&i==this.local?this:i.length||o.length?new e(i,o):A}},{key:"forChild",value:function(t,n){if(this==A)return this;if(n.isLeaf)return e.empty;for(var o,i,s=0;s<this.children.length;s+=3)if(this.children[s]>=t){this.children[s]==t&&(o=this.children[s+2]);break}for(var a=t+1,l=a+n.content.size,u=0;u<this.local.length;u++){var f=this.local[u];if(f.from<l&&f.to>a&&f.type instanceof Be){var d=Math.max(a,f.from)-a,c=Math.min(l,f.to)-a;d<c&&(i||(i=[])).push(f.copy(d,c))}}if(i){var h=new e(i.sort(me),Ne);return o?new Sn([h,o]):h}return o||A}},{key:"eq",value:function(t){if(this==t)return!0;if(!(t instanceof e)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(var n=0;n<this.local.length;n++)if(!this.local[n].eq(t.local[n]))return!1;for(var o=0;o<this.children.length;o+=3)if(this.children[o]!=t.children[o]||this.children[o+1]!=t.children[o+1]||!this.children[o+2].eq(t.children[o+2]))return!1;return!0}},{key:"locals",value:function(t){return ht(this.localsInner(t))}},{key:"localsInner",value:function(t){if(this==A)return Ne;if(t.inlineContent||!this.local.some(Be.is))return this.local;for(var n=[],o=0;o<this.local.length;o++)this.local[o].type instanceof Be||n.push(this.local[o]);return n}},{key:"forEachSet",value:function(t){t(this)}}],[{key:"create",value:function(t,n){return n.length?He(n,t,0,pe):A}}]),e}();j.empty=new j([],[]),j.removeOverlap=ht;var A=j.empty,Sn=function(){function e(r){M(this,e),this.members=r}return T(e,[{key:"map",value:function(t,n){var o=this.members.map(function(i){return i.map(t,n,pe)});return e.from(o)}},{key:"forChild",value:function(t,n){if(n.isLeaf)return j.empty;for(var o=[],i=0;i<this.members.length;i++){var s=this.members[i].forChild(t,n);s!=A&&(s instanceof e?o=o.concat(s.members):o.push(s))}return e.from(o)}},{key:"eq",value:function(t){if(!(t instanceof e)||t.members.length!=this.members.length)return!1;for(var n=0;n<this.members.length;n++)if(!this.members[n].eq(t.members[n]))return!1;return!0}},{key:"locals",value:function(t){for(var n,o=!0,i=0;i<this.members.length;i++){var s=this.members[i].localsInner(t);if(s.length)if(!n)n=s;else{o&&(n=n.slice(),o=!1);for(var a=0;a<s.length;a++)n.push(s[a])}}return n?ht(o?n:n.sort(me)):Ne}},{key:"forEachSet",value:function(t){for(var n=0;n<this.members.length;n++)this.members[n].forEachSet(t)}}],[{key:"from",value:function(t){switch(t.length){case 0:return A;case 1:return t[0];default:return new e(t.every(function(n){return n instanceof j})?t:t.reduce(function(n,o){return n.concat(o instanceof j?o:o.members)},[]))}}}]),e}();function co(e,r,t,n,o,i,s){for(var a=e.slice(),l=function(Z){var Oe=0;t.maps[u].forEach(function(G,P,Fo,Io){for(var Ge=Io-Fo-(P-G),ge=0;ge<a.length;ge+=3){var zn=a[ge+1];if(!(zn<0||G>zn+Z-Oe)){var Ln=a[ge]+Z-Oe;P>=Ln?a[ge+1]=G<=Ln?-2:-1:G>=Z&&Ge&&(a[ge]+=Ge,a[ge+1]+=Ge)}}Oe+=Ge}),Z=t.maps[u].map(Z,-1),f=Z},u=0,f=i;u<t.maps.length;u++)l(f);for(var d=!1,c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){d=!0,a[c+1]=-1;continue}var h=t.map(e[c]+i),p=h-o;if(p<0||p>=n.content.size){d=!0;continue}var g=t.map(e[c+1]+i,-1),v=g-o,m=n.content.findIndex(p),S=m.index,b=m.offset,y=n.maybeChild(S);if(y&&b==p&&b+y.nodeSize==v){var D=a[c+2].mapInner(t,y,h+1,e[c]+i+1,s);D!=A?(a[c]=p,a[c+1]=v,a[c+2]=D):(a[c+1]=-2,d=!0)}else d=!0}if(d){var N=ho(a,e,r,t,o,i,s),C=He(N,n,0,s);r=C.local;for(var J=0;J<a.length;J+=3)a[J+1]<0&&(a.splice(J,3),J-=3);for(var x=0,R=0;x<C.children.length;x+=3){for(var F=C.children[x];R<a.length&&a[R]<F;)R+=3;a.splice(R,0,C.children[x],C.children[x+1],C.children[x+2])}}return new j(r.sort(me),a)}function Nn(e,r){if(!r||!e.length)return e;for(var t=[],n=0;n<e.length;n++){var o=e[n];t.push(new he(o.from+r,o.to+r,o.type))}return t}function ho(e,r,t,n,o,i,s){function a(u,f){for(var d=0;d<u.local.length;d++){var c=u.local[d].map(n,o,f);c?t.push(c):s.onRemove&&s.onRemove(u.local[d].spec)}for(var h=0;h<u.children.length;h+=3)a(u.children[h+2],u.children[h]+f+1)}for(var l=0;l<e.length;l+=3)e[l+1]==-1&&a(e[l+2],r[l]+i+1);return t}function On(e,r,t){if(r.isLeaf)return null;for(var n=t+r.nodeSize,o=null,i=0,s;i<e.length;i++)(s=e[i])&&s.from>t&&s.to<n&&((o||(o=[])).push(s),e[i]=null);return o}function Cn(e){for(var r=[],t=0;t<e.length;t++)e[t]!=null&&r.push(e[t]);return r}function He(e,r,t,n){var o=[],i=!1;r.forEach(function(l,u){var f=On(e,l,u+t);if(f){i=!0;var d=He(f,l,t+u+1,n);d!=A&&o.push(u,u+l.nodeSize,d)}});for(var s=Nn(i?Cn(e):e,-t).sort(me),a=0;a<s.length;a++)s[a].type.valid(r,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new j(s,o):A}function me(e,r){return e.from-r.from||e.to-r.to}function ht(e){for(var r=e,t=0;t<r.length-1;t++){var n=r[t];if(n.from!=n.to)for(var o=t+1;o<r.length;o++){var i=r[o];if(i.from==n.from){i.to!=n.to&&(r==e&&(r=e.slice()),r[o]=i.copy(i.from,n.to),Mn(r,o+1,i.copy(n.to,i.to)));continue}else{i.from<n.to&&(r==e&&(r=e.slice()),r[t]=n.copy(n.from,i.from),Mn(r,o,n.copy(i.from,n.to)));break}}}return r}function Mn(e,r,t){for(;r<e.length&&me(t,e[r])>0;)r++;e.splice(r,0,t)}function pt(e){var r=[];return e.someProp("decorations",function(t){var n=t(e.state);n&&n!=A&&r.push(n)}),e.cursorWrapper&&r.push(j.create(e.state.doc,[e.cursorWrapper.deco])),Sn.from(r)}var po={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},mo=q&&ne<=11,go=function(){function e(){M(this,e),this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}return T(e,[{key:"set",value:function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}},{key:"clear",value:function(){this.anchorNode=this.focusNode=null}},{key:"eq",value:function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}]),e}(),vo=function(){function e(r,t){var n=this;M(this,e),this.view=r,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new go,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)n.queue.push(o[i]);q&&ne<=11&&o.some(function(s){return s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length})?n.flushSoon():n.flush()}),mo&&(this.onCharData=function(o){n.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}return T(e,[{key:"flushSoon",value:function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))}},{key:"forceFlush",value:function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}},{key:"start",value:function(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,po)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}},{key:"stop",value:function(){var t=this;if(this.observer){var n=this.observer.takeRecords();if(n.length){for(var o=0;o<n.length;o++)this.queue.push(n[o]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}},{key:"connectSelection",value:function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}},{key:"disconnectSelection",value:function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}},{key:"suppressSelectionUpdates",value:function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)}},{key:"onSelectionChange",value:function(){if(Xt(this.view)){if(this.suppressingSelectionUpdates)return ee(this.view);if(q&&ne<=11&&!this.view.state.selection.empty){var t=this.view.domSelectionRange();if(t.focusNode&&ue(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}},{key:"setCurSelection",value:function(){this.currentSelection.set(this.view.domSelectionRange())}},{key:"ignoreSelectionChange",value:function(t){if(!t.focusNode)return!0;for(var n=new Set,o,i=t.focusNode;i;i=Ce(i))n.add(i);for(var s=t.anchorNode;s;s=Ce(s))if(n.has(s)){o=s;break}var a=o&&this.view.docView.nearestDesc(o);if(a&&a.ignoreMutation({type:"selection",target:o.nodeType==3?o.parentNode:o}))return this.setCurSelection(),!0}},{key:"pendingRecords",value:function(){if(this.observer){var t=Ue(this.observer.takeRecords()),n;try{for(t.s();!(n=t.n()).done;){var o=n.value;this.queue.push(o)}}catch(i){t.e(i)}finally{t.f()}}return this.queue}},{key:"selectionChanged",value:function(t){return!this.suppressingSelectionUpdates&&!this.currentSelection.eq(t)&&Xt(this.view)&&!this.ignoreSelectionChange(t)}},{key:"flush",value:function(){var t=this.view;if(!(!t.docView||this.flushingSoon>-1)){var n=this.pendingRecords();n.length&&(this.queue=[]);var o=t.domSelectionRange(),i=this.selectionChanged(o),s=-1,a=-1,l=!1,u=[];if(t.editable)for(var f=0;f<n.length;f++){var d=this.registerMutation(n[f],u);d&&(s=s<0?d.from:Math.min(d.from,s),a=a<0?d.to:Math.max(d.to,a),d.typeOver&&(l=!0))}if(U&&u.length){var c=u.filter(function(N){return N.nodeName=="BR"});if(c.length==2){var h=gt(c,2),p=h[0],g=h[1];p.parentNode&&p.parentNode.parentNode==g.parentNode?g.remove():p.remove()}else{var v=this.currentSelection.focusNode,m=Ue(c),S;try{for(m.s();!(S=m.n()).done;){var b=S.value,y=b.parentNode;y&&y.nodeName=="LI"&&(!v||bo(t,v)!=y)&&b.remove()}}catch(N){m.e(N)}finally{m.f()}}}var D=null;s<0&&i&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&ze(o)&&(D=tt(t))&&D.eq(k.Selection.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,ee(t),this.currentSelection.set(o),t.scrollToSelection()):(s>-1||i)&&(s>-1&&(t.docView.markDirty(s,a),yo(t)),this.handleDOMChange(s,a,l,u),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(o)||ee(t),this.currentSelection.set(o))}}},{key:"registerMutation",value:function(t,n){if(n.indexOf(t.target)>-1)return null;var o=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(o==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!o||o.ignoreMutation(t))return null;if(t.type=="childList"){for(var i=0;i<t.addedNodes.length;i++){var s=t.addedNodes[i];n.push(s),s.nodeType==3&&(this.lastChangedTextNode=s)}if(o.contentDOM&&o.contentDOM!=o.dom&&!o.contentDOM.contains(t.target))return{from:o.posBefore,to:o.posAfter};var a=t.previousSibling,l=t.nextSibling;if(q&&ne<=11&&t.addedNodes.length)for(var u=0;u<t.addedNodes.length;u++){var f=t.addedNodes[u],d=f.previousSibling,c=f.nextSibling;(!d||Array.prototype.indexOf.call(t.addedNodes,d)<0)&&(a=d),(!c||Array.prototype.indexOf.call(t.addedNodes,c)<0)&&(l=c)}var h=a&&a.parentNode==t.target?V(a)+1:0,p=o.localPosFromDOM(t.target,h,-1),g=l&&l.parentNode==t.target?V(l):t.target.childNodes.length,v=o.localPosFromDOM(t.target,g,1);return{from:p,to:v}}else return t.type=="attributes"?{from:o.posAtStart-o.border,to:o.posAtEnd+o.border}:(this.lastChangedTextNode=t.target,{from:o.posAtStart,to:o.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}]),e}(),Tn=new WeakMap,Pn=!1;function yo(e){if(!Tn.has(e)&&(Tn.set(e,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)!==-1)){if(e.requiresGeckoHackNode=U,Pn)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Pn=!0}}function Vn(e,r){var t=r.startContainer,n=r.startOffset,o=r.endContainer,i=r.endOffset,s=e.domAtPos(e.state.selection.anchor);if(ue(s.node,s.offset,o,i)){var a=[o,i,t,n];t=a[0],n=a[1],o=a[2],i=a[3]}return{anchorNode:t,anchorOffset:n,focusNode:o,focusOffset:i}}function ko(e,r){if(r.getComposedRanges){var t=r.getComposedRanges(e.root)[0];if(t)return Vn(e,t)}var n;function o(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",o,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",o,!0),n?Vn(e,n):null}function bo(e,r){for(var t=r.parentNode;t&&t!=e.dom;t=t.parentNode){var n=e.docView.nearestDesc(t,!0);if(n&&n.node.isBlock)return t}return null}function Do(e,r,t){var n=e.docView.parseRange(r,t),o=n.node,i=n.fromOffset,s=n.toOffset,a=n.from,l=n.to,u=e.domSelectionRange(),f,d=u.anchorNode;if(d&&e.dom.contains(d.nodeType==1?d:d.parentNode)&&(f=[{node:d,offset:u.anchorOffset}],ze(u)||f.push({node:u.focusNode,offset:u.focusOffset})),E&&e.input.lastKeyCode===8)for(var c=s;c>i;c--){var h=o.childNodes[c-1],p=h.pmViewDesc;if(h.nodeName=="BR"&&!p){s=c;break}if(!p||p.size)break}var g=e.state.doc,v=e.someProp("domParser")||O.DOMParser.fromSchema(e.state.schema),m=g.resolve(a),S=null,b=v.parse(o,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:i,to:s,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:f,ruleFromNode:So,context:m});if(f&&f[0].pos!=null){var y=f[0].pos,D=f[1]&&f[1].pos;D==null&&(D=y),S={anchor:y+a,head:D+a}}return{doc:b,sel:S,from:a,to:l}}function So(e){var r=e.pmViewDesc;if(r)return r.parseRule();if(e.nodeName=="BR"&&e.parentNode){if(B&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){var t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(e.parentNode.lastChild==e||B&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if(e.nodeName=="IMG"&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}var No=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Oo(e,r,t,n,o){var i=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,r<0){var s=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,a=tt(e,s);if(a&&!e.state.selection.eq(a)){if(E&&Y&&e.input.lastKeyCode===13&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",function(P){return P(e,fe(13,"Enter"))}))return;var l=e.state.tr.setSelection(a);s=="pointer"?l.setMeta("pointer",!0):s=="key"&&l.scrollIntoView(),i&&l.setMeta("composition",i),e.dispatch(l)}return}var u=e.state.doc.resolve(r),f=u.sharedDepth(t);r=u.before(f+1),t=e.state.doc.resolve(t).after(f+1);var d=e.state.selection,c=Do(e,r,t),h=e.state.doc,p=h.slice(c.from,c.to),g,v;e.input.lastKeyCode===8&&Date.now()-100<e.input.lastKeyCodeTime?(g=e.state.selection.to,v="end"):(g=e.state.selection.from,v="start"),e.input.lastKeyCode=null;var m=To(p.content,c.doc.content,c.from,g,v);if(m&&e.input.domChangeCount++,(ye&&e.input.lastIOSEnter>Date.now()-225||Y)&&o.some(function(P){return P.nodeType==1&&!No.test(P.nodeName)})&&(!m||m.endA>=m.endB)&&e.someProp("handleKeyDown",function(P){return P(e,fe(13,"Enter"))})){e.input.lastIOSEnter=0;return}if(!m)if(n&&d instanceof k.TextSelection&&!d.empty&&d.$head.sameParent(d.$anchor)&&!e.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))m={start:d.from,endA:d.to,endB:d.to};else{if(c.sel){var S=xn(e,e.state.doc,c.sel);if(S&&!S.eq(e.state.selection)){var b=e.state.tr.setSelection(S);i&&b.setMeta("composition",i),e.dispatch(b)}}return}e.state.selection.from<e.state.selection.to&&m.start==m.endB&&e.state.selection instanceof k.TextSelection&&(m.start>e.state.selection.from&&m.start<=e.state.selection.from+2&&e.state.selection.from>=c.from?m.start=e.state.selection.from:m.endA<e.state.selection.to&&m.endA>=e.state.selection.to-2&&e.state.selection.to<=c.to&&(m.endB+=e.state.selection.to-m.endA,m.endA=e.state.selection.to)),q&&ne<=11&&m.endB==m.start+1&&m.endA==m.start&&m.start>c.from&&c.doc.textBetween(m.start-c.from-1,m.start-c.from+1)=="  "&&(m.start--,m.endA--,m.endB--);var y=c.doc.resolveNoCache(m.start-c.from),D=c.doc.resolveNoCache(m.endB-c.from),N=h.resolve(m.start),C=y.sameParent(D)&&y.parent.inlineContent&&N.end()>=m.endA,J;if((ye&&e.input.lastIOSEnter>Date.now()-225&&(!C||o.some(function(P){return P.nodeName=="DIV"||P.nodeName=="P"}))||!C&&y.pos<c.doc.content.size&&!y.sameParent(D)&&(J=k.Selection.findFrom(c.doc.resolve(y.pos+1),1,!0))&&J.head==D.pos)&&e.someProp("handleKeyDown",function(P){return P(e,fe(13,"Enter"))})){e.input.lastIOSEnter=0;return}if(e.state.selection.anchor>m.start&&Mo(h,m.start,m.endA,y,D)&&e.someProp("handleKeyDown",function(P){return P(e,fe(8,"Backspace"))})){Y&&E&&e.domObserver.suppressSelectionUpdates();return}E&&Y&&m.endB==m.start&&(e.input.lastAndroidDelete=Date.now()),Y&&!C&&y.start()!=D.start()&&D.parentOffset==0&&y.depth==D.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==m.endA&&(m.endB-=2,D=c.doc.resolveNoCache(m.endB-c.from),setTimeout(function(){e.someProp("handleKeyDown",function(P){return P(e,fe(13,"Enter"))})},20));var x=m.start,R=m.endA,F,We,Z;if(C){if(y.pos==D.pos)q&&ne<=11&&y.parentOffset==0&&(e.domObserver.suppressSelectionUpdates(),setTimeout(function(){return ee(e)},20)),F=e.state.tr.delete(x,R),We=h.resolve(m.start).marksAcross(h.resolve(m.endA));else if(m.endA==m.endB&&(Z=Co(y.parent.content.cut(y.parentOffset,D.parentOffset),N.parent.content.cut(N.parentOffset,m.endA-N.start()))))F=e.state.tr,Z.type=="add"?F.addMark(x,R,Z.mark):F.removeMark(x,R,Z.mark);else if(y.parent.child(y.index()).isText&&y.index()==D.index()-(D.textOffset?0:1)){var Oe=y.parent.textBetween(y.parentOffset,D.parentOffset);if(e.someProp("handleTextInput",function(P){return P(e,x,R,Oe)}))return;F=e.state.tr.insertText(Oe,x,R)}}if(F||(F=e.state.tr.replace(x,R,c.doc.slice(m.start-c.from,m.endB-c.from))),c.sel){var G=xn(e,F.doc,c.sel);G&&!(E&&Y&&e.composing&&G.empty&&(m.start!=m.endB||e.input.lastAndroidDelete<Date.now()-100)&&(G.head==x||G.head==F.mapping.map(R)-1)||q&&G.empty&&G.head==x)&&F.setSelection(G)}We&&F.ensureMarks(We),i&&F.setMeta("composition",i),e.dispatch(F.scrollIntoView())}function xn(e,r,t){return Math.max(t.anchor,t.head)>r.content.size?null:rt(e,r.resolve(t.anchor),r.resolve(t.head))}function Co(e,r){for(var t=e.firstChild.marks,n=r.firstChild.marks,o=t,i=n,s,a,l,u=0;u<n.length;u++)o=n[u].removeFromSet(o);for(var f=0;f<t.length;f++)i=t[f].removeFromSet(i);if(o.length==1&&i.length==0)a=o[0],s="add",l=function(p){return p.mark(a.addToSet(p.marks))};else if(o.length==0&&i.length==1)a=i[0],s="remove",l=function(p){return p.mark(a.removeFromSet(p.marks))};else return null;for(var d=[],c=0;c<r.childCount;c++)d.push(l(r.child(c)));if(O.Fragment.from(d).eq(e))return{mark:a,type:s}}function Mo(e,r,t,n,o){if(t-r<=o.pos-n.pos||mt(n,!0,!1)<o.pos)return!1;var i=e.resolve(r);if(!n.parent.isTextblock){var s=i.nodeAfter;return s!=null&&t==r+s.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var a=e.resolve(mt(i,!0,!0));return!a.parent.isTextblock||a.pos>t||mt(a,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(a.parent.content)}function mt(e,r,t){for(var n=e.depth,o=r?e.end():e.pos;n>0&&(r||e.indexAfter(n)==e.node(n).childCount);)n--,o++,r=!1;if(t)for(var i=e.node(n).maybeChild(e.indexAfter(n));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function To(e,r,t,n,o){var i=e.findDiffStart(r,t);if(i==null)return null;var s=e.findDiffEnd(r,t+e.size,t+r.size),a=s.a,l=s.b;if(o=="end"){var u=Math.max(0,i-Math.min(a,l));n-=a+u-i}if(a<i&&e.size<r.size){var f=n<=i&&n>=a?i-n:0;i-=f,i&&i<r.size&&En(r.textBetween(i-1,i+1))&&(i+=f?1:-1),l=i+(l-a),a=i}else if(l<i){var d=n<=i&&n>=l?i-n:0;i-=d,i&&i<e.size&&En(e.textBetween(i-1,i+1))&&(i+=d?1:-1),a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}function En(e){if(e.length!=2)return!1;var r=e.charCodeAt(0),t=e.charCodeAt(1);return r>=56320&&r<=57343&&t>=55296&&t<=56319}var Po=st,Vo=at,xo=Ae,Eo=function(){function e(r,t){var n=this;M(this,e),this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Ur,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Bn),this.dispatch=this.dispatch.bind(this),this.dom=r&&r.mount||document.createElement("div"),r&&(r.appendChild?r.appendChild(this.dom):typeof r=="function"?r(this.dom):r.mount&&(this.mounted=!0)),this.editable=Fn(this),Rn(this),this.nodeViews=In(this),this.docView=Lt(this.state.doc,An(this),pt(this),this.dom,this),this.domObserver=new vo(this,function(o,i,s,a){return Oo(n,o,i,s,a)}),this.domObserver.start(),Yr(this),this.updatePluginViews()}return T(e,[{key:"composing",get:function(){return this.input.composing}},{key:"props",get:function(){if(this._props.state!=this.state){var t=this._props;this._props={};for(var n in t)this._props[n]=t[n];this._props.state=this.state}return this._props}},{key:"update",value:function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&ut(this);var n=this._props;this._props=t,t.plugins&&(t.plugins.forEach(Bn),this.directPlugins=t.plugins),this.updateStateInner(t.state,n)}},{key:"setProps",value:function(t){var n={};for(var o in this._props)n[o]=this._props[o];n.state=this.state;for(var i in t)n[i]=t[i];this.update(n)}},{key:"updateState",value:function(t){this.updateStateInner(t,this._props)}},{key:"updateStateInner",value:function(t,n){var o,i=this.state,s=!1,a=!1;t.storedMarks&&this.composing&&(gn(this),a=!0),this.state=t;var l=i.plugins!=t.plugins||this._props.plugins!=n.plugins;if(l||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){var u=In(this);Ro(u,this.nodeViews)&&(this.nodeViews=u,s=!0)}(l||n.handleDOMEvents!=this._props.handleDOMEvents)&&ut(this),this.editable=Fn(this),Rn(this);var f=pt(this),d=An(this),c=i.plugins!=t.plugins&&!i.doc.eq(t.doc)?"reset":t.scrollToSelection>i.scrollToSelection?"to selection":"preserve",h=s||!this.docView.matchesNode(t.doc,d,f);(h||!t.selection.eq(i.selection))&&(a=!0);var p=c=="preserve"&&a&&this.dom.style.overflowAnchor==null&&sr(this);if(a){this.domObserver.stop();var g=h&&(q||E)&&!this.composing&&!i.selection.empty&&!t.selection.empty&&Ao(i.selection,t.selection);if(h){var v=E?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=io(this)),(s||!this.docView.update(t.doc,d,f,this))&&(this.docView.updateOuterDeco(d),this.docView.destroy(),this.docView=Lt(t.doc,d,f,this.dom,this)),v&&!this.trackWrites&&(g=!0)}g||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&xr(this))?ee(this,g):(Zt(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((o=this.dragging)===null||o===void 0)&&o.node&&!i.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,i),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():p&&ar(p)}},{key:"scrollToSelection",value:function(){var t=this,n=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",function(i){return i(t)}))if(this.state.selection instanceof k.NodeSelection){var o=this.docView.domAfterPos(this.state.selection.from);o.nodeType==1&&Ct(this,o.getBoundingClientRect(),n)}else Ct(this,this.coordsAtPos(this.state.selection.head,1),n)}},{key:"destroyPluginViews",value:function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()}},{key:"updatePluginViews",value:function(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var n=0;n<this.directPlugins.length;n++){var o=this.directPlugins[n];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var i=0;i<this.state.plugins.length;i++){var s=this.state.plugins[i];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(var a=0;a<this.pluginViews.length;a++){var l=this.pluginViews[a];l.update&&l.update(this,t)}}},{key:"updateDraggedNode",value:function(t,n){var o=t.node,i=-1;if(this.state.doc.nodeAt(o.from)==o.node)i=o.from;else{var s=o.from+(this.state.doc.content.size-n.doc.content.size),a=s>0&&this.state.doc.nodeAt(s);a==o.node&&(i=s)}this.dragging=new yn(t.slice,t.move,i<0?void 0:k.NodeSelection.create(this.state.doc,i))}},{key:"someProp",value:function(t,n){var o=this._props&&this._props[t],i;if(o!=null&&(i=n?n(o):o))return i;for(var s=0;s<this.directPlugins.length;s++){var a=this.directPlugins[s].props[t];if(a!=null&&(i=n?n(a):a))return i}var l=this.state.plugins;if(l)for(var u=0;u<l.length;u++){var f=l[u].props[t];if(f!=null&&(i=n?n(f):f))return i}}},{key:"hasFocus",value:function(){if(q){var t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}},{key:"focus",value:function(){this.domObserver.stop(),this.editable&&lr(this.dom),ee(this),this.domObserver.start()}},{key:"root",get:function(){var t=this,n=this._root;if(n==null){for(var o=function(l){if(l.nodeType==9||l.nodeType==11&&l.host)return l.getSelection||(Object.getPrototypeOf(l).getSelection=function(){return l.ownerDocument.getSelection()}),{v:t._root=l}},i,s=this.dom.parentNode;s;s=s.parentNode)if(i=o(s),i)return i.v}return n||document}},{key:"updateRoot",value:function(){this._root=null}},{key:"posAtCoords",value:function(t){return hr(this,t)}},{key:"coordsAtPos",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Et(this,t,n)}},{key:"domAtPos",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.docView.domFromPos(t,n)}},{key:"nodeDOM",value:function(t){var n=this.docView.descAt(t);return n?n.nodeDOM:null}},{key:"posAtDOM",value:function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=this.docView.posFromDOM(t,n,o);if(i==null)throw new RangeError("DOM position not inside the editor");return i}},{key:"endOfTextblock",value:function(t,n){return yr(this,n||this.state,t)}},{key:"pasteHTML",value:function(t,n){return Fe(this,"",t,!1,n||new ClipboardEvent("paste"))}},{key:"pasteText",value:function(t,n){return Fe(this,t,null,!0,n||new ClipboardEvent("paste"))}},{key:"destroy",value:function(){this.docView&&(jr(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],pt(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Zn())}},{key:"isDestroyed",get:function(){return this.docView==null}},{key:"dispatchEvent",value:function(t){return Zr(this,t)}},{key:"dispatch",value:function(t){var n=this._props.dispatchTransaction;n?n.call(this,t):this.updateState(this.state.apply(t))}},{key:"domSelectionRange",value:function(){var t=this.domSelection();return t?B&&this.root.nodeType===11&&er(this.dom.ownerDocument)==this.dom&&ko(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}},{key:"domSelection",value:function(){return this.root.getSelection()}}]),e}();function An(e){var r=Object.create(null);return r.class="ProseMirror",r.contenteditable=String(e.editable),e.someProp("attributes",function(t){if(typeof t=="function"&&(t=t(e.state)),t)for(var n in t)n=="class"?r.class+=" "+t[n]:n=="style"?r.style=(r.style?r.style+";":"")+t[n]:!r[n]&&n!="contenteditable"&&n!="nodeName"&&(r[n]=String(t[n]))}),r.translate||(r.translate="no"),[he.node(0,e.state.doc.content.size,r)]}function Rn(e){if(e.markCursor){var r=document.createElement("img");r.className="ProseMirror-separator",r.setAttribute("mark-placeholder","true"),r.setAttribute("alt",""),e.cursorWrapper={dom:r,deco:he.widget(e.state.selection.from,r,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function Fn(e){return!e.someProp("editable",function(r){return r(e.state)===!1})}function Ao(e,r){var t=Math.min(e.$anchor.sharedDepth(e.head),r.$anchor.sharedDepth(r.head));return e.$anchor.start(t)!=r.$anchor.start(t)}function In(e){var r=Object.create(null);function t(n){for(var o in n)Object.prototype.hasOwnProperty.call(r,o)||(r[o]=n[o])}return e.someProp("nodeViews",t),e.someProp("markViews",t),r}function Ro(e,r){var t=0,n=0;for(var o in e){if(e[o]!=r[o])return!0;t++}for(var i in r)n++;return t!=n}function Bn(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}return se.Decoration=he,se.DecorationSet=j,se.EditorView=Eo,se.__endComposition=xo,se.__parseFromClipboard=Vo,se.__serializeForClipboard=Po,se}var Wo=qo();export{Wo as d,qo as r};
