import{a as w}from"./@mozilla-DKYphB57.js";import{a as I}from"./prosemirror-state-gAnMHYNe.js";import{f as R,a as C}from"./prosemirror-transform-BGNlAVvU.js";class c{constructor(o,e,t={}){this.match=o,this.match=o,this.handler=typeof e=="string"?y(e):e,this.undoable=t.undoable!==!1,this.inCode=t.inCode||!1}}function y(r){return function(o,e,t,u){let n=r;if(e[1]){let l=e[0].lastIndexOf(e[1]);n+=e[0].slice(l+e[1].length),t+=l;let s=t-u;s>0&&(n=e[0].slice(l-s,l)+n,t=u)}return o.tr.insertText(n,t,u)}}const M=500;function O({rules:r}){let o=new I({state:{init(){return null},apply(e,t){let u=e.getMeta(this);return u||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,u,n){return m(e,t,u,n,r,o)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&m(e,t.pos,t.pos,"",r,o)})}}},isInputRules:!0});return o}function m(r,o,e,t,u,n){if(r.composing)return!1;let l=r.state,s=l.doc.resolve(o),i=s.parent.textBetween(Math.max(0,s.parentOffset-M),s.parentOffset,null,"￼")+t;for(let f=0;f<u.length;f++){let p=u[f];if(s.parent.type.spec.code){if(!p.inCode)continue}else if(p.inCode==="only")continue;let a=p.match.exec(i),d=a&&p.handler(l,a,o-(a[0].length-t.length),e);if(d)return p.undoable&&d.setMeta(n,{transform:d,from:o,to:e,text:t}),r.dispatch(d),!0}return!1}const S=(r,o)=>{let e=r.plugins;for(let t=0;t<e.length;t++){let u=e[t],n;if(u.spec.isInputRules&&(n=u.getState(r))){if(o){let l=r.tr,s=n.transform;for(let i=s.steps.length-1;i>=0;i--)l.step(s.steps[i].invert(s.docs[i]));if(n.text){let i=l.doc.resolve(n.from).marks();l.replaceWith(n.from,n.to,r.schema.text(n.text,i))}else l.delete(n.from,n.to);o(l)}return!0}}return!1},k=new c(/--$/,"—"),v=new c(/\.\.\.$/,"…"),h=new c(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“"),b=new c(/"$/,"”"),x=new c(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘"),$=new c(/'$/,"’"),Q=[h,b,x,$];function T(r,o,e=null,t){return new c(r,(u,n,l,s)=>{let i=e instanceof Function?e(n):e,f=u.tr.delete(l,s),p=f.doc.resolve(l),a=p.blockRange(),d=a&&R(a,o,i);if(!d)return null;f.wrap(a,d);let g=f.doc.resolve(l-1).nodeBefore;return g&&g.type==o&&C(f.doc,l-1)&&(!t||t(n,g))&&f.join(l-1),f})}function _(r,o,e=null){return new c(r,(t,u,n,l)=>{let s=t.doc.resolve(n),i=e instanceof Function?e(u):e;return s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),o)?t.tr.delete(n,l).setBlockType(n,n,o,i):null})}const B=Object.freeze(Object.defineProperty({__proto__:null,InputRule:c,closeDoubleQuote:b,closeSingleQuote:$,ellipsis:v,emDash:k,inputRules:O,openDoubleQuote:h,openSingleQuote:x,smartQuotes:Q,textblockTypeInputRule:_,undoInputRule:S,wrappingInputRule:T},Symbol.toStringTag,{value:"Module"})),F=w(B);export{c as I,O as i,F as r,S as u};
